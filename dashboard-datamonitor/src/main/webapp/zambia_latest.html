<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Admin Dashboard | Dashboard Data Monitor</title>

    <!-- Font Awesome -->
    <link href="media/css/font-awesome.min.css" rel="stylesheet">
    
    <link href="media/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom Theme Style -->
    <link href="media/css/custom.min.css" rel="stylesheet"> 
    
    <script type="text/javascript" src="//cdn.jsdelivr.net/jquery/2.1.3/jquery.min.js"></script>
	<script type="text/javascript" src="//cdn.jsdelivr.net/momentjs/2.9.0/moment.min.js"></script>
 
	<!-- Include date range picker plugin -->
	<script type="text/javascript" src="//cdn.jsdelivr.net/bootstrap.daterangepicker/1/daterangepicker.js"></script>
	<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/bootstrap.daterangepicker/1/daterangepicker-bs3.css" />
    
    <style>
	#flow_name_top h1{
		font-size:25px !important;
	}
	</style>
  </head>

  <body class="nav-md">
    <div class="container body">
      <div class="main_container">
        <div class="col-md-3 left_col">
          <div class="left_col scroll-view">
            <div class="navbar nav_title" style="border: 0;">
              <a href="./" class="site_title"><i class="glyphicon glyphicon-stats"></i> <span>Admin Dashboard</span></a>
            </div>

            <div class="clearfix"></div>

            <!-- menu profile quick info -->
            <div class="profile">
              <div class="profile_pic">
                <img src="media/images/user.png" alt="..." class="img-circle profile_img">
              </div>
              <div class="profile_info">
                <span>Welcome,</span>
                <h4 style="color:#ffffff">Admin</h4>
              </div>
            </div>
            <!-- /menu profile quick info -->

            <br /><br /><br /><br /><br />

            <!-- sidebar menu -->
            <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
              <div class="menu_section">
                <ul class="nav side-menu">
                  <!--<li><a><i class="fa fa-map-marker"></i> Kenya <span class="fa fa-chevron-down"></span></a>
                    <ul class="nav child_menu">
                      <li><a href="kenya.html">Dashboard</a></li>
                      <li><a href="ktable.html">Table</a></li>
                      <li><a href="flow-analytics-kenya.html">Flow Analytics</a></li>
                      <li><a href="contact-analytics-kenya.html">Contact Analysis</a></li>
                      <li><a href="kenya_map.html">Map</a></li>
                    </ul>
                  </li>-->
                  <li><a><i class="fa fa-map-marker"></i> Zambia <span class="fa fa-chevron-down"></span></a>
                    <ul class="nav child_menu">
                      <li><a href="zambia_latest.html">Dashboard</a></li>
                      <!--<li><a href="zambia.html">Dashboard</a></li>
                      <li><a href="ztable.html">Table</a></li>
                      <li><a href="flow-analytics-zambia.html">Flow Analytics</a></li>
                      <li><a href="contact-analytics-zambia.html">Contact Analytics</a></li>
                      <li><a href="zambia_map.html">Map</a></li>-->
                    </ul>
                  </li>                  
                </ul>
              </div>

            </div>
          </div>
        </div>

        <!-- top navigation -->
        <div class="top_nav">
          <div class="nav_menu">
            <nav class="" role="navigation">
              <div class="nav toggle">
                <a id="menu_toggle"><i class="fa fa-bars"></i></a>
              </div>
					
              <ul class="nav navbar-nav navbar-right">
              <div style="text-align:left;float:left;font-size:30px;"><strong>Dashboard DataMonitor - Zambia</strong></div>
                <li class="">
                  <a href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                    <img src="media/images/user.png" alt="">Admin
                    <span class=" fa fa-angle-down"></span>
                  </a>
                  <ul class="dropdown-menu dropdown-usermenu pull-right">
                    <li><a href="login.html"><i class="fa fa-sign-out pull-right"></i> Log Out</a></li>
                  </ul>
                </li>                
              </ul>
            </nav>
          </div>
        </div>
        <!-- /top navigation -->

        <!-- page content -->
        <div class="right_col" role="main">
        	 <div class="row">
              <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="dashboard_graph x_panel">
                  <div class="row x_title">
                    <div class="col-md-6">
                      <h3>Farmers Response Rate <small> -  over time</small></h3>
                    </div>
                    <div class="col-md-6">
                      <div id="reportrange" class="pull-right" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc">
                        <i class="glyphicon glyphicon-calendar fa fa-calendar"></i>
                        <span>December 30, 2014 - January 28, 2015</span> <b class="caret"></b>
                      </div>
                    </div>
                    <hr>
                    <div class="form-group">
                        <div class="col-md-9 col-sm-9 col-xs-12 col-md-offset-3">
                          <button type="submit" class="btn btn-success pull-right" id="saveBtn">Submit</button>
                        </div>
                     </div>
                  </div>
                <div>
                  <div id="chartContainer" class="demo-placeholder" style="height:350px !important;width:100% !important;"></div>
                </div>
                  <div class="clearfix"></div>
                </div>
              </div>
            </div> 
            
            <div class="row">
              <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="dashboard_graph x_panel">
                  <div class="row x_title">
                    <div class="col-md-6">
                      <h3>File sizes by type per week <small> -  over time</small></h3>
                    </div>
                    <div class="col-md-6">
                      <div id="reportrange1" class="pull-right" style="background: #fff; cursor: pointer; padding: 5px 0px;">
                        <label for="sel1">Select number of past weeks from today:</label>
                          <select class="form-control" id="sel1">
                            <option>1 week</option>
                            <option>2 weeks</option>
                            <option>3 weeks</option>
                            <option selected="selected">4 weeks</option>
                            <option>5 weeks</option>
                            <option>6 weeks</option>
                          </select>
                      </div>
                    </div>
                    <hr>
                    <div class="form-group">
                        <div class="col-md-9 col-sm-9 col-xs-12 col-md-offset-3">
                          <button type="submit" class="btn btn-success pull-right" id="saveBtn1">Submit</button>
                        </div>
                     </div>
                  </div>
                <div>
                  <div id="chartContainer1" class="demo-placeholder" style="height:350px !important;width:100% !important;"></div>
                </div>
                  <div class="clearfix"></div>
                </div>
              </div>
            </div> 
            
            <div class="row">
              <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="dashboard_graph x_panel">
                  <div class="row x_title">
                    <div class="col-md-6">
                      <h3>Number of farmers indicated yes/no to the “Did it rain…” question <small> -  over time</small></h3>
                    </div>
                    <div class="col-md-6">
                      <div id="reportrange2" class="pull-right" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc">
                        <i class="glyphicon glyphicon-calendar fa fa-calendar"></i>
                        <span>December 30, 2014 - January 28, 2015</span> <b class="caret"></b>
                      </div>
                    </div>
                    <hr>
                    <div class="form-group">
                        <div class="col-md-9 col-sm-9 col-xs-12 col-md-offset-3">
                          <button type="submit" class="btn btn-success pull-right" id="saveBtn2">Submit</button>
                        </div>
                     </div>
                  </div>
                <div>
                  <div id="chartContainer2" class="demo-placeholder" style="height:350px !important;width:100% !important;"></div>
                </div>
                  <div class="clearfix"></div>
                </div>
              </div>
            </div>   
		</div>        
        
        <!-- /page content -->    
      
      <!-- footer content -->
        <footer>
          <div class="pull-right">
           Dashboard Data Monitor - Admin Monitoring UI
          </div>
          <div class="clearfix"></div>
        </footer>
      <!-- /footer content -->
    </div>
   </div>

    <!-- Bootstrap -->
    <script src="media/js/bootstrap.min.js"></script>
    <!-- Custom Theme Scripts -->
    <script src="media/js/custom.min.js"></script>
    <script type="text/javascript" src="media/js/jquery.canvasjs.min.js"></script>
    <script type="text/javascript">	
		var startDate;
		var endDate;

		var FromEndDate = new Date();
		var textit_prefix = "./api/zambia";
		
		$(document).ready(function() {
			var today = FromEndDate;
			
			var now = new Date();
			var today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
			var lastMonday = new Date(today.setDate(today.getDate()-(today.getDay()-1)%7));
			var last_monday = new Date(lastMonday.setHours(lastMonday.getHours()+12));
			var beforeMonday = new Date(lastMonday.getFullYear(), lastMonday.getMonth(), lastMonday.getDate()-7);
			var before_monday = new Date(beforeMonday.setHours(beforeMonday.getHours()+12));
			var lastbeforeMonday = new Date(lastMonday.getFullYear(), lastMonday.getMonth(), lastMonday.getDate()-14);
			var lasttwobeforeMonday = new Date(lastMonday.getFullYear(), lastMonday.getMonth(), lastMonday.getDate()-21);
			var lastthreebeforeMonday = new Date(lastMonday.getFullYear(), lastMonday.getMonth(), lastMonday.getDate()-28);
			var lastfourbeforeMonday = new Date(lastMonday.getFullYear(), lastMonday.getMonth(), lastMonday.getDate()-35);
			var last_four_before_monday = new Date(lastfourbeforeMonday.setHours(lastfourbeforeMonday.getHours()+12));
			
			var to_date = moment(last_monday).format("YYYY-MM-DDTHH:mm:ss.SSS");
			var from_date = moment(before_monday).format("YYYY-MM-DDTHH:mm:ss.SSS");
			var new_from_date = from_date + "Z";
			var new_to_date = to_date + "Z";

			/* New code for first graph - Farmers Response Rate - over time */		
		
			$.ajax({
				url: textit_prefix + "/flowcompletion?from=" + new_from_date + "&to=" + new_to_date,
				success: function (frdata) {				
				
				flow_steps_correct_final_data = [];
				flow_name_array = [];				
		
					for (j in frdata){
							flow_steps_corrct_data = [];
							
							if (frdata[j].flow_name.indexOf("harvest") >= 0 || frdata[j].flow_name.indexOf("growing") >= 0 || frdata[j].flow_name.indexOf("inter-season") >= 0 || frdata[j].flow_name.indexOf("planting") >= 0) {
								if (frdata[j].hasOwnProperty("matrix")){									
									flow_name_array.push(frdata[j].flow_name);
									for (q=0; q < frdata[j].matrix.length; q++){
								
									not_ans = frdata[j].matrix[q].perc;
									ques_label = frdata[j].matrix[q].hour;
									
									flow_steps_corrct_data.push({"x" : ques_label, "y" : not_ans});	
									}
								}
								flow_steps_correct_final_data.push(flow_steps_corrct_data)						
							}
						
					}
		
				}
		});
		
		setTimeout(function () {
		
		if (flow_steps_correct_final_data.length == 1){		
		
		var chart = new CanvasJS.Chart("chartContainer" ,
		{
		  title:{
				text: "Farmers Response Rate"
			},
			axisX:{
				interval: 12,
				title: "Time(in hours)",							
			},
			axisY:{
				interval: 10,
				title: "In Percentage(%)",							
			},
			toolTip: {
				shared: true,
				content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
			},	
		  exportEnabled: true,
		  data: [ 
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[0],
			dataPoints: flow_steps_correct_final_data[0]
		  }
		  ],
		  legend:{
			cursor:"pointer",
			itemclick: function(e) {
			  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
				  e.dataSeries.visible = false;
			  }
			  else
			  {
				e.dataSeries.visible = true;
			  }
			  chart.render();
			}
		  }
		});
	
		chart.render();
		
		}else if(flow_steps_correct_final_data.length == 2){
			
			var chart = new CanvasJS.Chart("chartContainer" ,
		{
		  title:{
				text: "Farmers Response Rate"
			},
			axisX:{
				interval: 12,
				title: "Time(in hours)",							
			},
			axisY:{
				interval: 10,
				title: "In Percentage(%)",							
			},
			toolTip: {
				shared: true,
				content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
				
			},	
		  exportEnabled: true,
		  data: [ 
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[0],
			dataPoints: flow_steps_correct_final_data[0]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true", 
			name: flow_name_array[1],
			dataPoints: flow_steps_correct_final_data[1]
		  }
		  ],
		  legend:{
			cursor:"pointer",
			itemclick: function(e) {
			  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
				  e.dataSeries.visible = false;
			  }
			  else
			  {
				e.dataSeries.visible = true;
			  }
			  chart.render();
			}
		  }
		});
	
		chart.render();
			
			
		}else if(flow_steps_correct_final_data.length == 3){
			
			var chart = new CanvasJS.Chart("chartContainer" ,
		{
		  title:{
				text: "Farmers Response Rate"
			},
			axisX:{
				interval: 12,
				title: "Time(in hours)",							
			},
			axisY:{
				interval: 10,
				title: "In Percentage(%)",							
			},
			toolTip: {
				shared: true,
				content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
			},	
		  exportEnabled: true,
		  data: [ 
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[0],
			dataPoints: flow_steps_correct_final_data[0]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[1],
			dataPoints: flow_steps_correct_final_data[1]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[2],
			dataPoints: flow_steps_correct_final_data[2]
		  }
		  ],
		  legend:{
			cursor:"pointer",
			itemclick: function(e) {
			  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
				  e.dataSeries.visible = false;
			  }
			  else
			  {
				e.dataSeries.visible = true;
			  }
			  chart.render();
			}
		  }
		});
	
		chart.render();
			
		}else if (flow_steps_correct_final_data.length == 4){
			
			var chart = new CanvasJS.Chart("chartContainer" ,
		{
		  title:{
				text: "Farmers Response Rate"
			},
			axisX:{
				interval: 12,
				title: "Time(in hours)",							
			},
			axisY:{
				interval: 10,
				title: "In Percentage(%)",							
			},
			toolTip: {
				shared: true,
				content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
			},	
		  exportEnabled: true,
		  data: [ 
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[0],
			dataPoints: flow_steps_correct_final_data[0]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[1],
			dataPoints: flow_steps_correct_final_data[1]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[2],
			dataPoints: flow_steps_correct_final_data[2]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[3],
			dataPoints: flow_steps_correct_final_data[3]
		  }
		  ],
		  legend:{
			cursor:"pointer",
			itemclick: function(e) {
			  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
				  e.dataSeries.visible = false;
			  }
			  else
			  {
				e.dataSeries.visible = true;
			  }
			  chart.render();
			}
		  }
		});
	
		chart.render();			
			
		}else{
			var chart = new CanvasJS.Chart("chartContainer" ,
			{
		  	title:{
				text: "No valid data available within this date range",
				fontColor: "#2f4f4f",
				fontSize: 30,
				padding: 10,
				margin: 15,
				backgroundColor: "#FFFFE0",
				borderThickness: 1,
				cornerRadius: 5,
				fontWeight: "bold",
				verticalAlign: "center"
			},
			axisX:{
				interval: 12,
				title: "Time(in hours)",							
			},
			axisY:{
				interval: 10,
				title: "In Percentage(%)",							
			},
			toolTip: {
				shared: true
			},	
		    exportEnabled: true,
		    data: [ 
		    {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: null,
			dataPoints: null
		  }
		  ],
		  legend:{
			cursor:"pointer",
			itemclick: function(e) {
			  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
				  e.dataSeries.visible = false;
			  }
			  else
			  {
				e.dataSeries.visible = true;
			  }
			  chart.render();
			}
		  }
		});
	
		chart.render();		
		}
	  
	  }, 1500);
	  
	  /*  ##### */

	/* 2nd graph - File sizes by type per week - over time */
	var week_count = "4";
	$.ajax({
		url: textit_prefix + "/filesize?count=" + week_count,
		success: function (sdata) {	
	
		flow_size_runs_array = [];
		flow_size_flows_array = [];
		flow_size_contacts_array = [];	
	
		for (f in sdata){
			week_label = sdata[f].week;
			
			flow_size_flows_array.push({"label" : week_label, "y" : Math.round(sdata[f].matrix[0].count/1000), "cat_name" : "flows"});		
			
			flow_size_runs_array.push({"label" : week_label, "y" : Math.round(sdata[f].matrix[1].count/1000), "cat_name" : "runs"});				
	
			flow_size_contacts_array.push({"label" : week_label, "y" : Math.round(sdata[f].matrix[2].count/1000), "cat_name" : "contacts"});
			
			}

		}
	});
	
	setTimeout(function () {
 
 	var chart = new CanvasJS.Chart("chartContainer1",
		{
			title:{
				text: "File sizes by type"
			},
			toolTip:{shared: true,
         	contentFormatter: function ( e ) {
                 var content =  "<strong>" + e.entries[0].dataPoint.label + "</strong>";
                 for(var i = 0; i< e.entries.length; i++){
                   content += "</br>"+e.entries[i].dataPoint.cat_name + " : ";
                   content +=  CanvasJS.formatNumber(Math.round(Math.pow(10,e.entries[i].dataPoint.y))) + " kB";
                 }
                 return content;
     		 } 
       },			
			axisY:{
         	title: "size of file in (kB)",
         	labelFormatter: function ( e ) {
               var lable = Math.pow(10 ,e.value);
               if(lable>=1000)
               		lable = CanvasJS.formatNumber(lable/1000) +"k";
               else
               		lable =  CanvasJS.formatNumber(lable);
               return lable;
			 },
			 interval : 1,
			 includeZero :false
       },
			axisX: {
				title: "Time (in weeks)",
				interval: 1,
				labelAngle : -15
			},
			exportEnabled: true,				
			data: [ 
			{
				type: "column",	
				name: "Runs",
				legendText: "Runs",
				showInLegend: true, 
				dataPoints:flow_size_runs_array.reverse()
			},
			{
				type: "column",	
				name: "Flows",
				legendText: "Flows",
				showInLegend: true,
				dataPoints:flow_size_flows_array.reverse()
			},
			{
				type: "column",	
				name: "Contacts",
				legendText: "Contacts",
				showInLegend: true,
				dataPoints:flow_size_contacts_array.reverse()
			}
			
			],
          legend:{
            cursor:"pointer",
            itemclick: function(e){
              if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
              	e.dataSeries.visible = false;
              }
              else {
                e.dataSeries.visible = true;
              }
            	chart.render();
            }
          },
        });
	convertToLog(chart.options.data);
	chart.render();

	}, 2000);

	 function convertToLog(data){
		var dataPoints;
		for(var j= 0; j<data.length;j++){
			dataPoints = data[j].dataPoints;
			for(var i = 0; i< dataPoints.length; i++){
			  dataPoints[i].y = Math.log10(dataPoints[i].y);
			}
		 }
	 }

/* ############ */

/* 3rd graph - Number of farmers indicated yes/no to the “Did it rain…” question - over time */
	ques_type = "rain";
	var stat_date = moment(last_four_before_monday).format("YYYY-MM-DDTHH:mm:ss.SSS");
	var new_stat_date = stat_date + "Z";	
	
	$.ajax({
		url: textit_prefix + "/questionanalysis?type=" + ques_type + "&from=" + new_stat_date + "&to=" + new_to_date,
		success: function (quesdata) {				
		
		yes_array = [];
		no_array = [];
		other_array = [];
		
			for (q in quesdata){	
				week_label = quesdata[q].day;
				for(i=0; i < quesdata[q].matrix.length; i++){							
					if (quesdata[q].matrix[i].anw == "No"){
						no_array.push({"label" : week_label, "y" : quesdata[q].matrix[i].count, "cat_name" : "no"});		
					}else if (quesdata[q].matrix[i].anw == "Yes"){
						yes_array.push({"label" : week_label, "y" : quesdata[q].matrix[i].count, "cat_name" : "yes"});				
					}else if (quesdata[q].matrix[i].anw == "Other"){
						other_array.push({"label" : week_label, "y" : quesdata[q].matrix[i].count, "cat_name" : "other_response"});
					}
				}
			}

		}
	});

	setTimeout(function () {
	var chart = new CanvasJS.Chart("chartContainer2",
			{
				title:{
					text: "Number of farmers indicated yes/no to the “Did it rain…” question"
				},
				toolTip: {
					shared: true
				},			
				axisY: {
					title: "Number of farmers"
				},
				exportEnabled: true,			
				data: [ 
				{
					type: "column",	
					name: "Yes",
					legendText: "Yes",
					showInLegend: true, 
					dataPoints: yes_array
				},
				{
					type: "column",	
					name: "No",
					legendText: "No",
					showInLegend: true,
					dataPoints: no_array
				},
				{
					type: "column",	
					name: "Other Response",
					legendText: "Other Response",
					showInLegend: true,
					dataPoints: other_array
				}
				
				],
			  legend:{
				cursor:"pointer",
				itemclick: function(e){
				  if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
					e.dataSeries.visible = false;
				  }
				  else {
					e.dataSeries.visible = true;
				  }
					chart.render();
				}
			  },
			});
	
	chart.render();
		
		}, 2000);
	
	/* ######## */
	
	/* code for after choose date or dropdown option and then click the submit function */
	/* For first graph */
    $('#reportrange').daterangepicker(
       {
          startDate: beforeMonday,
          endDate: lastMonday,
          minDate: '20/06/2016',
          maxDate: FromEndDate,
          //dateLimit: { days: 60 },
          showDropdowns: true,
          showWeekNumbers: true,
          timePicker: false,
          timePickerIncrement: 1,
          timePicker12Hour: true,
          ranges: {
             //'Today': [moment(), moment()],
             //'Yesterday': [moment().subtract('days', 1), moment().subtract('days', 1)],
             'Last Week': [moment(beforeMonday), moment(lastMonday)],
			 'Last 2 Weeks' : [moment(lastbeforeMonday), moment(lastMonday)],
             'Last 3 Weeks': [moment(lasttwobeforeMonday), moment(lastMonday)],
			 'Last 4 Weeks': [moment(lastthreebeforeMonday), moment(lastMonday)],
             'This Month': [moment().startOf('month'), moment().endOf('month')],
             'Last Month': [moment().subtract('month', 1).startOf('month'), moment().subtract('month', 1).endOf('month')]
          },
          opens: 'left',
          buttonClasses: ['btn btn-default'],
          applyClass: 'btn-small btn-primary',
          cancelClass: 'btn-small',
          format: 'DD/MM/YYYY',
          separator: ' to ',
          locale: {
              applyLabel: 'Submit',
              fromLabel: 'From',
              toLabel: 'To',
              customRangeLabel: 'Custom Range',
              daysOfWeek: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr','Sa'],
              monthNames: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
              firstDay: 1
          }
       },
       function(start, end) {
        console.log("Callback has been called!");
        $('#reportrange span').html(start.format('D MMMM YYYY') + ' - ' + end.format('D MMMM YYYY'));
        startDate = start;
        endDate = end;    

       }
    );
    //Set the initial state of the picker label
    $('#reportrange span').html(moment(beforeMonday).format('D MMMM YYYY') + ' - ' + moment(lastMonday).format('D MMMM YYYY'));

    $('#saveBtn').click(function(){
		from_date = startDate.format("YYYY-MM-DDTHH:mm:ss.SSS");
		to_date = endDate.format("YYYY-MM-DDTHH:mm:ss.SSS");
		
		new_end_date = new Date(endDate);
		new_end_date_sr = new Date(new_end_date.setHours(new_end_date.getHours()-12))
		new_end_date_sr_lk = moment(new_end_date_sr).format("YYYY-MM-DDTHH:mm:ss.SSS");
		
		new_start_date = new Date(startDate);
		new_start_date_sr = new Date(new_start_date.setHours(new_start_date.getHours()+12))
		new_start_date_sr_lk = moment(new_start_date_sr).format("YYYY-MM-DDTHH:mm:ss.SSS");
				
		var new_from_date = new_start_date_sr_lk + "Z";
		var new_to_date = new_end_date_sr_lk + "Z";
		
		$.ajax({
				url: textit_prefix + "/flowcompletion?from=" + new_from_date + "&to=" + new_to_date,
				success: function (frdata) {				
				
				response_final_data = [];
				flow_name_array = [];				
		
					for (j in frdata){						
							
							if (frdata[j].flow_name.indexOf("harvest") >= 0 || frdata[j].flow_name.indexOf("growing") >= 0 || frdata[j].flow_name.indexOf("inter-season") >= 0 || frdata[j].flow_name.indexOf("planting") >= 0) {								
								
								if (frdata[j].hasOwnProperty("matrix")){
									flow_steps_data = [];
									flow_steps_corrct_data = [];
									flow_name_array.push(frdata[j].flow_name);
									for (q=0; q < frdata[j].matrix.length; q++){
								
										not_ans = frdata[j].matrix[q].perc;
										ques_label = frdata[j].matrix[q].hour;
										
										flow_steps_corrct_data.push({"x" : ques_label, "y" : not_ans});	
									}
									response_final_data.push(flow_steps_corrct_data)	
								}													
							}						
					}		
				}
		});
		
		
		setTimeout(function () {
		
		if (response_final_data.length == 1){		
		
		var chart = new CanvasJS.Chart("chartContainer" ,
		{
		  title:{
				text: "Farmers Response Rate"
			},
			axisX:{
				interval: 12,
				title: "Time(in hours)",							
			},
			axisY:{
				interval: 10,
				title: "In Percentage(%)",							
			},
			toolTip: {
				shared: true,
				content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
			},	
		  exportEnabled: true,
		  data: [ 
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[0],
			dataPoints: response_final_data[0]
		  }
		  ],
		  legend:{
			cursor:"pointer",
			itemclick: function(e) {
			  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
				  e.dataSeries.visible = false;
			  }
			  else
			  {
				e.dataSeries.visible = true;
			  }
			  chart.render();
			}
		  }
		});
	
		chart.render();
		
		}else if(response_final_data.length == 2){
			
			var chart = new CanvasJS.Chart("chartContainer" ,
		{
		  title:{
				text: "Farmers Response Rate"
			},
			axisX:{
				interval: 12,
				title: "Time(in hours)",							
			},
			axisY:{
				interval: 10,
				title: "In Percentage(%)",							
			},
			toolTip: {
				shared: true,
				content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
			},	
		  exportEnabled: true,
		  data: [ 
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[0],
			dataPoints: response_final_data[0]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[1],
			dataPoints: response_final_data[1]
		  }
		  ],
		  legend:{
			cursor:"pointer",
			itemclick: function(e) {
			  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
				  e.dataSeries.visible = false;
			  }
			  else
			  {
				e.dataSeries.visible = true;
			  }
			  chart.render();
			}
		  }
		});
	
		chart.render();
			
			
		}else if(response_final_data.length == 3){
			
			var chart = new CanvasJS.Chart("chartContainer" ,
		{
		  title:{
				text: "Farmers Response Rate"
			},
			axisX:{
				interval: 12,
				title: "Time(in hours)",							
			},
			axisY:{
				interval: 10,
				title: "In Percentage(%)",							
			},
			toolTip: {
				shared: true,
				content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
			},	
		  exportEnabled: true,
		  data: [ 
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[0],
			dataPoints: response_final_data[0]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[1],
			dataPoints: response_final_data[1]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[2],
			dataPoints: response_final_data[2]
		  }
		  ],
		  legend:{
			cursor:"pointer",
			itemclick: function(e) {
			  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
				  e.dataSeries.visible = false;
			  }
			  else
			  {
				e.dataSeries.visible = true;
			  }
			  chart.render();
			}
		  }
		});
	
		chart.render();
			
		}else if (response_final_data.length == 4){
			
			var chart = new CanvasJS.Chart("chartContainer" ,
		{
		  title:{
				text: "Farmers Response Rate"
			},
			axisX:{
				interval: 12,
				title: "Time(in hours)",							
			},
			axisY:{
				interval: 10,
				title: "In Percentage(%)",							
			},
			toolTip: {
				shared: true,
				content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
			},	
		  exportEnabled: true,
		  data: [ 
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[0],
			dataPoints: response_final_data[0]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true", 
			name: flow_name_array[1],
			dataPoints: response_final_data[1]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true", 
			name: flow_name_array[2],
			dataPoints: response_final_data[2]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[3],
			dataPoints: response_final_data[3]
		  }
		  ],
		  legend:{
			cursor:"pointer",
			itemclick: function(e) {
			  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
				  e.dataSeries.visible = false;
			  }
			  else
			  {
				e.dataSeries.visible = true;
			  }
			  chart.render();
			}
		  }
		});
	
		chart.render();			
			
		}else if (response_final_data.length == 5){
			
			var chart = new CanvasJS.Chart("chartContainer" ,
		{
		  title:{
				text: "Farmers Response Rate"
			},
			axisX:{
				interval: 12,
				title: "Time(in hours)",							
			},
			axisY:{
				interval: 10,
				title: "In Percentage(%)",							
			},
			toolTip: {
				shared: true,
				content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
			},	
		  exportEnabled: true,
		  data: [ 
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[0],
			dataPoints: response_final_data[0]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true", 
			name: flow_name_array[1],
			dataPoints: response_final_data[1]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true", 
			name: flow_name_array[2],
			dataPoints: response_final_data[2]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[3],
			dataPoints: response_final_data[3]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[4],
			dataPoints: response_final_data[4]
		  }
		  ],
		  legend:{
			cursor:"pointer",
			itemclick: function(e) {
			  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
				  e.dataSeries.visible = false;
			  }
			  else
			  {
				e.dataSeries.visible = true;
			  }
			  chart.render();
			}
		  }
		});
	
		chart.render();
			
		}else if(response_final_data.length == 6){
				var chart = new CanvasJS.Chart("chartContainer" ,
		{
		  title:{
				text: "Farmers Response Rate"
			},
			axisX:{
				interval: 12,
				title: "Time(in hours)",							
			},
			axisY:{
				interval: 10,
				title: "In Percentage(%)",							
			},
			toolTip: {
				shared: true,
				content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
			},	
		  exportEnabled: true,
		  data: [ 
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[0],
			dataPoints: response_final_data[0]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true", 
			name: flow_name_array[1],
			dataPoints: response_final_data[1]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true", 
			name: flow_name_array[2],
			dataPoints: response_final_data[2]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[3],
			dataPoints: response_final_data[3]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[4],
			dataPoints: response_final_data[4]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[5],
			dataPoints: response_final_data[5]
		  }
		  ],
		  legend:{
			cursor:"pointer",
			itemclick: function(e) {
			  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
				  e.dataSeries.visible = false;
			  }
			  else
			  {
				e.dataSeries.visible = true;
			  }
			  chart.render();
			}
		  }
		});
	
		chart.render();
			
		}else if(response_final_data.length == 7){
				var chart = new CanvasJS.Chart("chartContainer" ,
		{
		  title:{
				text: "Farmers Response Rate"
			},
			axisX:{
				interval: 12,
				title: "Time(in hours)",							
			},
			axisY:{
				interval: 10,
				title: "In Percentage(%)",							
			},
			toolTip: {
				shared: true,
				content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
			},	
		  exportEnabled: true,
		  data: [ 
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[0],
			dataPoints: response_final_data[0]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true", 
			name: flow_name_array[1],
			dataPoints: response_final_data[1]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true", 
			name: flow_name_array[2],
			dataPoints: response_final_data[2]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[3],
			dataPoints: response_final_data[3]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[4],
			dataPoints: response_final_data[4]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[5],
			dataPoints: response_final_data[5]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[6],
			dataPoints: response_final_data[6]
		  }
		  ],
		  legend:{
			cursor:"pointer",
			itemclick: function(e) {
			  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
				  e.dataSeries.visible = false;
			  }
			  else
			  {
				e.dataSeries.visible = true;
			  }
			  chart.render();
			}
		  }
		});
	
		chart.render();
			
		}else if(response_final_data.length == 8){
				var chart = new CanvasJS.Chart("chartContainer" ,
		{
		  title:{
				text: "Farmers Response Rate"
			},
			axisX:{
				interval: 12,
				title: "Time(in hours)",							
			},
			axisY:{
				interval: 10,
				title: "In Percentage(%)",							
			},
			toolTip: {
				shared: true,
				content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
			},	
		  exportEnabled: true,
		  data: [ 
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[0],
			dataPoints: response_final_data[0]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true", 
			name: flow_name_array[1],
			dataPoints: response_final_data[1]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true", 
			name: flow_name_array[2],
			dataPoints: response_final_data[2]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[3],
			dataPoints: response_final_data[3]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[4],
			dataPoints: response_final_data[4]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[5],
			dataPoints: response_final_data[5]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[6],
			dataPoints: response_final_data[6]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[7],
			dataPoints: response_final_data[7]
		  }
		  ],
		  legend:{
			cursor:"pointer",
			itemclick: function(e) {
			  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
				  e.dataSeries.visible = false;
			  }
			  else
			  {
				e.dataSeries.visible = true;
			  }
			  chart.render();
			}
		  }
		});
	
		chart.render();
			
		}else if(response_final_data.length == 9){
				var chart = new CanvasJS.Chart("chartContainer" ,
		{
		  title:{
				text: "Farmers Response Rate"
			},
			axisX:{
				interval: 12,
				title: "Time(in hours)",							
			},
			axisY:{
				interval: 10,
				title: "In Percentage(%)",							
			},
			toolTip: {
				shared: true,
				content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
			},	
		  exportEnabled: true,
		  data: [ 
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[0],
			dataPoints: response_final_data[0]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true", 
			name: flow_name_array[1],
			dataPoints: response_final_data[1]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true", 
			name: flow_name_array[2],
			dataPoints: response_final_data[2]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[3],
			dataPoints: response_final_data[3]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[4],
			dataPoints: response_final_data[4]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[5],
			dataPoints: response_final_data[5]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[6],
			dataPoints: response_final_data[6]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[7],
			dataPoints: response_final_data[7]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[8],
			dataPoints: response_final_data[8]
		  }
		  ],
		  legend:{
			cursor:"pointer",
			itemclick: function(e) {
			  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
				  e.dataSeries.visible = false;
			  }
			  else
			  {
				e.dataSeries.visible = true;
			  }
			  chart.render();
			}
		  }
		});
	
		chart.render();
			
		}else if(response_final_data.length == 10){
				var chart = new CanvasJS.Chart("chartContainer" ,
		{
		  title:{
				text: "Farmers Response Rate"
			},
			axisX:{
				interval: 12,
				title: "Time(in hours)",							
			},
			axisY:{
				interval: 10,
				title: "In Percentage(%)",							
			},
			toolTip: {
				shared: true,
				content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
			},	
		  exportEnabled: true,
		  data: [ 
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[0],
			dataPoints: response_final_data[0]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true", 
			name: flow_name_array[1],
			dataPoints: response_final_data[1]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true", 
			name: flow_name_array[2],
			dataPoints: response_final_data[2]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[3],
			dataPoints: response_final_data[3]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[4],
			dataPoints: response_final_data[4]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[5],
			dataPoints: response_final_data[5]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[6],
			dataPoints: response_final_data[6]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[7],
			dataPoints: response_final_data[7]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[8],
			dataPoints: response_final_data[8]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[9],
			dataPoints: response_final_data[9]
		  }
		  ],
		  legend:{
			cursor:"pointer",
			itemclick: function(e) {
			  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
				  e.dataSeries.visible = false;
			  }
			  else
			  {
				e.dataSeries.visible = true;
			  }
			  chart.render();
			}
		  }
		});
	
		chart.render();
			
		}else if(response_final_data.length == 11){
				var chart = new CanvasJS.Chart("chartContainer" ,
		{
		  title:{
				text: "Farmers Response Rate"
			},
			axisX:{
				interval: 12,
				title: "Time(in hours)",							
			},
			axisY:{
				interval: 10,
				title: "In Percentage(%)",							
			},
			toolTip: {
				shared: true,
				content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
			},	
		  exportEnabled: true,
		  data: [ 
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[0],
			dataPoints: response_final_data[0]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true", 
			name: flow_name_array[1],
			dataPoints: response_final_data[1]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true", 
			name: flow_name_array[2],
			dataPoints: response_final_data[2]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[3],
			dataPoints: response_final_data[3]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[4],
			dataPoints: response_final_data[4]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[5],
			dataPoints: response_final_data[5]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[6],
			dataPoints: response_final_data[6]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[7],
			dataPoints: response_final_data[7]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[8],
			dataPoints: response_final_data[8]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[9],
			dataPoints: response_final_data[9]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[10],
			dataPoints: response_final_data[10]
		  }
		  ],
		  legend:{
			cursor:"pointer",
			itemclick: function(e) {
			  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
				  e.dataSeries.visible = false;
			  }
			  else
			  {
				e.dataSeries.visible = true;
			  }
			  chart.render();
			}
		  }
		});
	
		chart.render();
			
		}else if(response_final_data.length == 12){
				var chart = new CanvasJS.Chart("chartContainer" ,
		{
		  title:{
				text: "Farmers Response Rate"
			},
			axisX:{
				interval: 12,
				title: "Time(in hours)",							
			},
			axisY:{
				interval: 10,
				title: "In Percentage(%)",							
			},
			toolTip: {
				shared: true,
				content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
			},	
		  exportEnabled: true,
		  data: [ 
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[0],
			dataPoints: response_final_data[0]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true", 
			name: flow_name_array[1],
			dataPoints: response_final_data[1]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true", 
			name: flow_name_array[2],
			dataPoints: response_final_data[2]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[3],
			dataPoints: response_final_data[3]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[4],
			dataPoints: response_final_data[4]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[5],
			dataPoints: response_final_data[5]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[6],
			dataPoints: response_final_data[6]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[7],
			dataPoints: response_final_data[7]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[8],
			dataPoints: response_final_data[8]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[9],
			dataPoints: response_final_data[9]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[10],
			dataPoints: response_final_data[10]
		  },
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: flow_name_array[11],
			dataPoints: response_final_data[11]
		  }
		  ],
		  legend:{
			cursor:"pointer",
			itemclick: function(e) {
			  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
				  e.dataSeries.visible = false;
			  }
			  else
			  {
				e.dataSeries.visible = true;
			  }
			  chart.render();
			}
		  }
		});
	
		chart.render();
			
		}else{
			var chart = new CanvasJS.Chart("chartContainer" ,
		{
		  title:{
				text: "No valid data available within this date range",
				fontColor: "#2f4f4f",
				fontSize: 30,
				padding: 10,
				margin: 15,
				backgroundColor: "#FFFFE0",
				borderThickness: 1,
				cornerRadius: 5,
				fontWeight: "bold",
				verticalAlign: "center"
			},
			axisX:{
				interval: 12,
				title: "Time(in hours)",							
			},
			axisY:{
				interval: 10,
				title: "In Percentage(%)",							
			},
			toolTip: {
				shared: true
			},	
		  exportEnabled: true,
		  data: [ 
		  {        
			type: "line",
			lineThickness:3,
			showInLegend: "true",
			name: "",
			dataPoints: null
		  }
		  ],
		  legend:{
			cursor:"pointer",
			itemclick: function(e) {
			  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
				  e.dataSeries.visible = false;
			  }
			  else
			  {
				e.dataSeries.visible = true;
			  }
			  chart.render();
			}
		  }
		});
	
		chart.render();		
		}
	  
	  }, 1000);		

    });
	/* ########## */
	
	/* 2nd graph */
	$('#saveBtn1').click(function(){
		
	var week_count_click = $('#sel1 :selected').text().split(" ")[0];
	$.ajax({
		url: textit_prefix + "/filesize?count=" + week_count_click,
		success: function (clsdata) {	
	
		click_flow_size_runs_array = [];
		click_flow_size_flows_array = [];
		click_flow_size_contacts_array = [];	
	
		for (f in clsdata){
			week_label = clsdata[f].week;
			
			click_flow_size_flows_array.push({"label" : week_label, "y" : Math.round(clsdata[f].matrix[0].count/1000), "cat_name" : "flows"});		
			
			click_flow_size_runs_array.push({"label" : week_label, "y" : Math.round(clsdata[f].matrix[1].count/1000), "cat_name" : "runs"});				
	
			click_flow_size_contacts_array.push({"label" : week_label, "y" : Math.round(clsdata[f].matrix[2].count/1000), "cat_name" : "contacts"});
			
			}

		}
	});
	
	setTimeout(function () {
	var chart = new CanvasJS.Chart("chartContainer1",
		{
		title:{
			text: "File sizes by type"
		},
		toolTip:{
			shared: true,
         contentFormatter: function ( e ) {
                 var content =  "<strong>" + e.entries[0].dataPoint.label + "</strong>";
                 for(var i = 0; i< e.entries.length; i++){
                   content += "</br>"+e.entries[i].dataPoint.cat_name + " : ";
                   content +=  CanvasJS.formatNumber(Math.round(Math.pow(10,e.entries[i].dataPoint.y))) + " kB";
                 }
                 return content;
     		 } 
       },			
		 axisY:{
         title: "size of file in (kB)",
         labelFormatter: function ( e ) {
               var lable = Math.pow(10 ,e.value);
               if(lable>=1000)
               		lable = CanvasJS.formatNumber(lable/1000) +"k";
               else
               		lable =  CanvasJS.formatNumber(lable);
               return lable;
         },
         interval : 1,
         includeZero :false
       },
		exportEnabled: true,				
		data: [ 
		{
			type: "column",	
			name: "Runs",
			legendText: "Runs",
			showInLegend: true, 
			dataPoints:click_flow_size_runs_array.reverse()
		},
		{
			type: "column",	
			name: "Flows",
			legendText: "Flows",
			showInLegend: true,
			dataPoints:click_flow_size_flows_array.reverse()
		},
		{
			type: "column",	
			name: "Contacts",
			legendText: "Contacts",
			showInLegend: true,
			dataPoints:click_flow_size_contacts_array.reverse()
		}
		
		],
	  legend:{
		cursor:"pointer",
		itemclick: function(e){
		  if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
			e.dataSeries.visible = false;
		  }
		  else {
			e.dataSeries.visible = true;
		  }
			chart.render();
		}
	  },
	});
	convertToLog(chart.options.data);
	chart.render();

	}, 2000);

	 function convertToLog(data){
		var dataPoints;
		for(var j= 0; j<data.length;j++){
			dataPoints = data[j].dataPoints;
			for(var i = 0; i< dataPoints.length; i++){
			  dataPoints[i].y = Math.log10(dataPoints[i].y);
			}
		 }
	 }

    });
	
	/* ################# */
	
	/* 3rd graph */
	$('#reportrange2').daterangepicker(
       {
          startDate: lastfourbeforeMonday,
          endDate: lastMonday,
          minDate: '20/06/2016',
          maxDate: FromEndDate,
          //dateLimit: { days: 60 },
          showDropdowns: true,
          showWeekNumbers: true,
          timePicker: false,
          timePickerIncrement: 1,
          timePicker12Hour: true,
          ranges: {
             //'Today': [moment(), moment()],
             //'Yesterday': [moment().subtract('days', 1), moment().subtract('days', 1)],
             'Last Week': [moment(beforeMonday), moment(lastMonday)],
			 'Last 2 Weeks' : [moment(lastbeforeMonday), moment(lastMonday)],
             'Last 3 Weeks': [moment(lasttwobeforeMonday), moment(lastMonday)],
			 'Last 4 Weeks': [moment(lastthreebeforeMonday), moment(lastMonday)],
             'This Month': [moment().startOf('month'), moment().endOf('month')],
             'Last Month': [moment().subtract('month', 1).startOf('month'), moment().subtract('month', 1).endOf('month')]
          },
          opens: 'left',
          buttonClasses: ['btn btn-default'],
          applyClass: 'btn-small btn-primary',
          cancelClass: 'btn-small',
          format: 'DD/MM/YYYY',
          separator: ' to ',
          locale: {
              applyLabel: 'Submit',
              fromLabel: 'From',
              toLabel: 'To',
              customRangeLabel: 'Custom Range',
              daysOfWeek: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr','Sa'],
              monthNames: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
              firstDay: 1
          }
       },
       function(start, end) {
        console.log("Callback has been called!");
        $('#reportrange2 span').html(start.format('D MMMM YYYY') + ' - ' + end.format('D MMMM YYYY'));
        startDate = start;
        endDate = end;    

       }
    );
    //Set the initial state of the picker label
    $('#reportrange2 span').html(moment(lastfourbeforeMonday).format('D MMMM YYYY') + ' - ' + moment(lastMonday).format('D MMMM YYYY'));	
	
	$('#saveBtn2').click(function(){
		
		from_date = startDate.format("YYYY-MM-DDTHH:mm:ss.SSS");
		to_date = endDate.format("YYYY-MM-DDTHH:mm:ss.SSS");
		
		new_end_date = new Date(endDate);
		new_end_date_sr = new Date(new_end_date.setHours(new_end_date.getHours()-12))
		new_end_date_sr_lk = moment(new_end_date_sr).format("YYYY-MM-DDTHH:mm:ss.SSS");
		
		new_start_date = new Date(startDate);
		new_start_date_sr = new Date(new_start_date.setHours(new_start_date.getHours()+12))
		new_start_date_sr_lk = moment(new_start_date_sr).format("YYYY-MM-DDTHH:mm:ss.SSS");
				
		var new_from_date = new_start_date_sr_lk + "Z";
		var new_to_date = new_end_date_sr_lk + "Z";
	
	
	$.ajax({
		url: textit_prefix + "/questionanalysis?type=" + ques_type + "&from=" + new_from_date + "&to=" + new_to_date,
		success: function (quesdata) {				
		
		yes_array = [];
		no_array = [];
		other_array = [];
		
			for (q in quesdata){	
				week_label = quesdata[q].day;
				for(i=0; i < quesdata[q].matrix.length; i++){							
					if (quesdata[q].matrix[i].anw == "No"){
						no_array.push({"label" : week_label, "y" : quesdata[q].matrix[i].count, "cat_name" : "no"});		
					}else if (quesdata[q].matrix[i].anw == "Yes"){
						yes_array.push({"label" : week_label, "y" : quesdata[q].matrix[i].count, "cat_name" : "yes"});				
					}else if (quesdata[q].matrix[i].anw == "Other"){
						other_array.push({"label" : week_label, "y" : quesdata[q].matrix[i].count, "cat_name" : "other_response"});
					}
				}
			}

		}
	});	
	
	setTimeout(function () {
	var chart = new CanvasJS.Chart("chartContainer2",
		{
			title:{
				text: "Number of farmers indicated yes/no to the “Did it rain…” question",
				fontSize: 30
			},
			toolTip: {
				shared: true
			},			
			axisY: {
				title: "Number of farmers"
			},	
			exportEnabled: true,		
			data: [ 
			{
				type: "column",	
				name: "Yes",
				legendText: "Yes",
				showInLegend: true, 
				dataPoints: yes_array
			},
			{
				type: "column",	
				name: "No",
				legendText: "No",
				showInLegend: true,
				dataPoints: no_array
			},			
			{
				type: "column",	
				name: "Other Response",
				legendText: "Other Response",
				showInLegend: true,
				dataPoints: other_array
			}
			
			],
          legend:{
            cursor:"pointer",
            itemclick: function(e){
              if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
              	e.dataSeries.visible = false;
              }
              else {
                e.dataSeries.visible = true;
              }
            	chart.render();
            }
          },
        });

	chart.render();
	
	}, 2000);

	});
	
	/* ############### */
	
 });
</script>
</body>
</html>