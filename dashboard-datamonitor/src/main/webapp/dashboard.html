<!DOCTYPE html>
<html lang="en">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <!-- Meta, title, CSS, favicons, etc. -->
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>Admin Dashboard | Dashboard Data Monitor</title>
      <!-- Bootstrap -->
      <link href="media/css/bootstrap.min.css" rel="stylesheet">
      <!-- Font Awesome -->
      <link href="media/css/font-awesome.min.css" rel="stylesheet">
      <!-- Custom Theme Style -->
      <link href="media/css/custom.min.css" rel="stylesheet">
      <!-- Weather Style -->
      <link rel="stylesheet" type="text/css" href="media/css/jquery-ui.css"/>
      <link rel="stylesheet" href="media/css/weather.css" />
      <script src="media/js/jquery-min.js"></script>
      <script src="media/js/jquery-ui.js"></script>
      <script src="media/js/weather.js"></script>
      <!-- Include date range picker plugin -->
      <script type="text/javascript" src="media/js/datepicker/daterangepicker.js"></script>
      <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/bootstrap.daterangepicker/1/daterangepicker-bs3.css" />
      <link rel="stylesheet" href="http://code.jquery.com/ui/1.8.23/themes/base/jquery-ui.css">
      <script src="media/js/jquery-ui.js"></script>
      <style type="text/css">
         .count{
         font-size:18px !important;
         }h2{
         font-size:23px !important;
         }h2.weather {
         font-size:18px !important;
         }.today p{
         font-size:13px !important;
         }.tile_stats_count .count {
         line-height:20px !important;
         }.row {
         margin-top:-12px !important;
         }h2.analysis {
         font-size:28px !important;
         }
      </style>
      <script type="text/javascript">        
         $(document).ready(function () {
             $(".weather").weatherFeed({relativeTimeZone:true});
          });
      </script>
      <script type="text/javascript">
         var _gaq = _gaq || [];
         _gaq.push(['_setAccount', 'UA-36251023-1']);
         _gaq.push(['_setDomainName', 'jqueryscript.net']);
         _gaq.push(['_trackPageview']);
         
         (function() {
         var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
         ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
         var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
         })();
      </script>
   </head>
   <body style="background-color:#ffffff;">
      <div>
         <div style="text-align:center;;font-size:30px;margin:10px;"><strong>Zambia – Farmer SMS Reporting System</strong></div>
         <!-- page content -->
         <div class="right_col" role="main"  style="margin:0 auto">
            <div>
               <ul class="nav nav-tabs" role="tablist" style="font-size:18px;">
                  <li class="active">
                     <a href="#tab-top-table1" data-toggle="tab">Zambia</a>
                  </li>
                  <li>
                     <a href="#tab-top-table2" data-toggle="tab">Kenya</a>
                  </li>
               </ul>
               <div class="tab-content">
                  <div class="tab-pane active" id="tab-top-table1">
                     <div class="clearfix"></div>
                     <div class="col-md-12 col-sm-12 col-xs-12">
                        <div class="x_panel">
                           <div class="x_content">
                              <div>
                                 <div>
                                    <ul class="nav nav-tabs" role="tablist" style="font-size:15px">
                                       <li class="active">
                                          <a href="#tab-table1" data-toggle="tab">Monitoring</a>
                                       </li>
                                       <li>
                                          <a href="#tab-table2" data-toggle="tab">Flow Analytics</a>
                                       </li>
                                       <li>
                                          <a href="#tab-table3" data-toggle="tab">Contact Analytics</a>
                                       </li>
                                       <li>
                                          <a href="#tab-table4" data-toggle="tab">Tables and Metadata</a>
                                       </li>
                                    </ul>
                                    <div class="tab-content">
                                       <div class="tab-pane active" id="tab-table1">
                                          <h3 style="text-align:center;padding:20px 0px 40px 0px;">Weekly Overview <span class="count_top" id="lastweek" style="font-size:13px"></span></h3>
                                          <!-- top tiles -->
                                          <div class="row tile_count">
                                             <div class="col-md-4 col-sm-4 col-xs-6 tile_stats_count" style="text-align:center">
                                                <span class="count_top" style="font-size:15px;font-weight:600;">Flows Overview</span>
                                                <div style="text-align:center;margin:10px;"><span class="count_top" style="font-size:13px"> Total Flows  :  </span><span class="count blue" id="total_flows_count"></span></div>
                                                <div style="text-align:center;margin:10px;"><span class="count_top" style="font-size:13px"> Started Last Week <span class="count_top" id="lastweek1"></span> <br>Open Flows  :  </span><span class="count blue" id="last_week_comp_flow_count"></span></div>
                                                <div style="text-align:center;margin:10px;"><span class="count_top" style="font-size:13px"> Resend Flows  :  </span><span class="count blue" id="last_week_comp_resend_flow_count"></span></div>
                                             </div>
                                             <div class="col-md-4 col-sm-4 col-xs-6 tile_stats_count" style="text-align:center">
                                                <span class="count_top" style="font-size:15px;font-weight:600;">Respondents(Contact) Overview</span>
                                                <div style="text-align:center;margin:10px;"><span class="count_top" style="font-size:13px"> Total Contacts  :  </span><span class="count blue" id="total_user_count"></span></div>
                                                <div style="text-align:center;margin:10px;"><span class="count_top" style="font-size:13px"> Active Last Week <span class="count_top" id="lastweek2"></span>  :  </span><span class="count blue" id="last_week_user_count"></span></div>
                                                <div style="text-align:center;margin:10px;"><span class="count_top" style="font-size:13px"> Inactive Last Week <span class= "count_top" id="lastweek3"></span>  :  </span><span class="count blue" id="last_week_inactive_user_count"></span></div>
                                             </div>
                                             <div class="col-md-4 col-sm-5 col-xs-7 tile_stats_count" style="text-align:center">
                                                <span class="count_top" style="font-size:15px;font-weight:600;">Downloads and Server Overview <span class="count_top" id="lastweek4"></span></span>
                                                <div style="text-align:center;padding:0px 10%; 0px 5px;margin:10px;" id="server_status">
                                                </div>
                                             </div>
                                          </div>
                                          <hr>
                                          </hr>
                                          <div class="clearfix" style="padding:10px;"></div>
                                          <div class="row">
                                             <div class="col-md-6 col-sm-6 col-xs-6">
                                                <div class="dashboard_graph x_panel">
                                                   <div class="row x_title">
                                                      <div class="col-md-6">
                                                         <h3>Weekly run completion rate <small> (over time)</small></h3>
                                                      </div>
                                                      <div class="col-md-6">
                                                         <div id="reportrange" class="pull-right" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc">
                                                            <i class="glyphicon glyphicon-calendar fa fa-calendar"></i>
                                                            <span>December 30, 2014 - January 28, 2015</span> <b class="caret"></b>
                                                         </div>
                                                      </div>
                                                      <hr>
                                                      <div class="form-group">
                                                         <div class="col-md-9 col-sm-9 col-xs-12 col-md-offset-3">
                                                            <button type="submit" class="btn btn-success pull-right" id="saveBtn">Submit</button>
                                                         </div>
                                                      </div>
                                                   </div>
                                                   <div>
                                                      <div id="chartContainer" class="demo-placeholder" style="height:350px !important;width:100% !important;"></div>
                                                   </div>
                                                   <div class="clearfix"></div>
                                                </div>
                                             </div>
                                             <div class="col-md-1 col-sm-1 col-xs-1">
                                             </div>
                                             <div class="col-md-5 col-sm-5 col-xs-8" style="padding-top:10px;height:450px;overflow:scroll;">
                                                <div id="not_respond_contact" class="x_panel"></div>
                                             </div>
                                          </div>
                                          <hr>
                                          </hr>
                                          <div class="clearfix" style="padding:10px;"></div>
                                          <div class="row">
                                             <div class="col-md-6 col-sm-6 col-xs-6">
                                                <div class="dashboard_graph x_panel">
                                                   <div class="row x_title">
                                                      <div class="col-md-4">
                                                         <h3>Response analysis <small> (over time)</small></h3>
                                                      </div>
                                                      <div class="col-md-8">
                                                         <div id="reportrange2" class="pull-right" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc">
                                                            <!--<i class="glyphicon glyphicon-calendar fa fa-calendar"></i>
                                                               <span>December 30, 2014 - January 28, 2015</span> <b class="caret"></b>-->
                                                            <label for="from">From</label>
                                                            <input type="text" id="from" name="from">
                                                            <label for="to">to</label>
                                                            <input type="text" id="to" name="to">
                                                         </div>
                                                      </div>
                                                      <hr>
                                                      <div class="form-group">
                                                         <div class="col-md-9 col-sm-9 col-xs-12 col-md-offset-3">
                                                            <button type="submit" class="btn btn-success pull-right" id="saveBtn2">Submit</button>
                                                         </div>
                                                      </div>
                                                   </div>
                                                   <div>
                                                      <div id="chartContainer2" class="demo-placeholder" style="height:350px !important;width:100% !important;"></div>
                                                   </div>
                                                   <div class="clearfix"></div>
                                                </div>
                                             </div>
                                             <div class="col-md-6 col-sm-6 col-xs-6">
                                                <div class="dashboard_graph x_panel">
                                                   <div class="row x_title">
                                                      <div class="col-md-4">
                                                         <h3>Response analysis <small> (over time)</small></h3>
                                                      </div>
                                                      <div class="col-md-8">
                                                         <div id="reportrange3" class="pull-right" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc">
                                                            <!--<i class="glyphicon glyphicon-calendar fa fa-calendar"></i>
                                                               <span>December 30, 2014 - January 28, 2015</span> <b class="caret"></b>-->
                                                            <label for="from1">From</label>
                                                            <input type="text" id="from1" name="from1">
                                                            <label for="to1">to</label>
                                                            <input type="text" id="to1" name="to1">
                                                         </div>
                                                      </div>
                                                      <hr>
                                                      <div class="form-group">
                                                         <div class="col-md-9 col-sm-9 col-xs-12 col-md-offset-3">
                                                            <button type="submit" class="btn btn-success pull-right" id="saveBtn3">Submit</button>
                                                         </div>
                                                      </div>
                                                   </div>
                                                   <div>
                                                      <div id="chartContainer3" class="demo-placeholder" style="height:350px !important;width:100% !important;"></div>
                                                   </div>
                                                   <div class="clearfix"></div>
                                                </div>
                                             </div>
                                          </div>
                                          <hr>
                                          </hr>
                                          <div class="clearfix" style="padding:10px;"></div>
                                          <div class="row">
                                             <div class="col-md-6 col-sm-6 col-xs-6">
                                                <div class="dashboard_graph x_panel">
                                                   <div class="row x_title">
                                                      <div class="col-md-4">
                                                         <h3>Response analysis <small> (over time)</small></h3>
                                                      </div>
                                                      <div class="col-md-8">
                                                         <div id="reportrange4" class="pull-right" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc">
                                                            <!--<i class="glyphicon glyphicon-calendar fa fa-calendar"></i>
                                                               <span>December 30, 2014 - January 28, 2015</span> <b class="caret"></b>-->
                                                            <label for="from2">From</label>
                                                            <input type="text" id="from2" name="from2">
                                                            <label for="to2">to</label>
                                                            <input type="text" id="to2" name="to2">
                                                         </div>
                                                      </div>
                                                      <hr>
                                                      <div class="form-group">
                                                         <div class="col-md-9 col-sm-9 col-xs-12 col-md-offset-3">
                                                            <button type="submit" class="btn btn-success pull-right" id="saveBtn4">Submit</button>
                                                         </div>
                                                      </div>
                                                   </div>
                                                   <div>
                                                      <div id="chartContainer4" class="demo-placeholder" style="height:350px !important;width:100% !important;"></div>
                                                   </div>
                                                   <div class="clearfix"></div>
                                                </div>
                                             </div>
                                          </div>
                                          <div style="margin-top:50px;"></div>
                                       </div>
                                       <div class="tab-pane" id="tab-table2">
                                          <h3 style="text-align:center;">Runs Table</h3>
                                          <table id="runTable" class="table table-striped table-bordered" width="100%" cellspacing="0">
                                             <thead>
                                                <tr>
                                                   <th>Flow UUID</th>
                                                   <th>Flow</th>
                                                   <th>Contact</th>
                                                   <th>Created On</th>
                                                   <th>Modified On</th>
                                                   <th>Completed</th>
                                                   <th>Expires On</th>
                                                   <th>Qustions</th>
                                                   <th>Answers</th>
                                                </tr>
                                             </thead>
                                          </table>
                                          <div style="margin-top:50px;"></div>
                                       </div>
                                       <div class="tab-pane" id="tab-table3">
                                          <h3 style="text-align:center;">Contact Table</h3>
                                          <table id="contactTable" class="table table-striped table-bordered" width="100%" cellspacing="0">
                                             <thead>
                                                <tr>
                                                   <th>UUID</th>
                                                   <th>Name</th>
                                                   <th>Language</th>
                                                   <th>Phone No</th>
                                                   <th>Group UUID</th>
                                                   <th>Modified Date</th>
                                                </tr>
                                             </thead>
                                          </table>
                                          <div style="margin-top:50px;"></div>
                                       </div>
                                       <div class="tab-pane" id="tab-table4">
                                          <h3 style="text-align:center;">Question Table(Did it rain on your fields this week?)</h3>
                                          <table id="questionTable" class="table table-striped table-bordered" width="100%" cellspacing="0">
                                             <thead>
                                                <tr>
                                                   <th>nth week : week interval</th>
                                                   <th># of farmers respond "Yes"</th>
                                                   <th># of farmers respond "No"</th>
                                                   <th># of farmers respond "Other"</th>
                                                </tr>
                                             </thead>
                                          </table>
                                          <div style="margin-top:50px;"></div>
                                       </div>
                                       <div style="margin-top:50px;"></div>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
            <!-- /page content -->
            <!-- footer content -->
            <div class="right_col">
               <footer>
                  <div class="pull-right">
                     Dashboard Data Monitor - Admin Monitoring UI
                  </div>
                  <div class="clearfix"></div>
               </footer>
            </div>
            <!-- /footer content -->
         </div>
      </div>
      <!-- Bootstrap -->
      <script src="media/js/bootstrap.min.js"></script>
      <!-- bootstrap-daterangepicker -->
      <script src="media/js/moment/moment.min.js"></script>
      <script src="media/js/datepicker/daterangepicker.js"></script>
      <!-- Custom Theme Scripts -->
      <script src="media/js/custom.min.js"></script>
      <script type="text/javascript" src="media/js/jquery.dataTables.min.js"></script>
      <script type="text/javascript" src="media/js/jquery.canvasjs.min.js"></script>
      <script type="text/javascript">
         $(document).ready(function() {
         
         function getLastWeek(){
         var today = new Date();
         var lastWeek = new Date(today.getFullYear(), today.getMonth(), today.getDate() - 7);
         return lastWeek;
         }
         
         function getLastSunday() {
         var now = new Date();
         var today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
         var lastSunday = new Date(today.setDate(today.getDate()-today.getDay()));
         return lastSunday;
         }
         
         function getLastBeforeMonday(){
         var now = new Date();
         var today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
         var lastMonday = new Date(today.setDate(today.getDate()-(today.getDay()-1)%7));
         var beforeMonday = new Date(lastMonday.getFullYear(), lastMonday.getMonth(), lastMonday.getDate()-7);
         return beforeMonday;
         }
         
         function getLastMonday(){
         var now = new Date();
         var today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
         var lastMonday = new Date(today.setDate(today.getDate()-(today.getDay()-1)%7));
         return lastMonday;
         }
         
         var lastWeek = getLastWeek();
         var lastSunday = getLastSunday();
         var lastBeforeMonday = getLastBeforeMonday();
         var lastMonday = getLastMonday();	
         
         lastweek_output = '<strong>[' + moment(lastBeforeMonday).format('MMMM Do YYYY') + ' - ' + moment(lastMonday).format('MMMM Do YYYY') + ']</strong>';
         $("#lastweek").html(lastweek_output);
         $("#lastweek1").html(lastweek_output);
         $("#lastweek2").html(lastweek_output);
         $("#lastweek3").html(lastweek_output);
         $("#lastweek4").html(lastweek_output);
         
         flow_rule_data =[];
         completed_runs_data = [];		
         total_runs_data = [];
         more_recent_flow = [];
         archived_flows = [];
         last_week_archived_flows =[];
         open_flows = [];
         last_week_open_flows =[];
         last_week_flow_status = [];
         last_week_runs_status = [];
         last_week_contacts_status = [];		
         
         var textit_prefix = "./api/zambia";
         var contact_count = 10;
         $.ajax({
         url: textit_prefix + "/activecontacts?count=" + contact_count,
         success: function (cdata) {
         var total_contacts = cdata.length;
         output = '<div class="x_title"><h2>Inactive Farmers <small> -  ' + lastweek_output + '</small></h2><div class="clearfix"></div></div><ul class="list-unstyled top_profiles scroll-view">';
         for (c=0; c < cdata.length; c++){
         output += '<li class="media event">' + 
         	   ' <a class="pull-left border-aero profile_thumb">' +
         		  '<i class="fa fa-user aero"></i>' +
         		'</a>' +
         		'<div class="media-body">' +
         		  '<a class="title" href="#">' + cdata[c].name + '</a>' +
         		  '<p><strong>Phone: </strong>' +  cdata[c].contact_no +
         		  '<p> <strong>Created on: </strong><small>' + moment(cdata[c].created_on).format('MMMM Do YYYY, h:mm:ss a') + '</small> </p>' +
         		'</div>' +
         	  '</li>';
         }
         output += '<ul>';
         $("#most_recent_contact").html(output);
         
         }
         });
			 
		 
		 /* Inactive Farmers - for last three months*/
		 var textit_prefix_api = "http://smallholderag-test.d2i.indiana.edu:8080/textit-api/zambia"
	     //var textit_prefix_api = "http://localhost:8080/textit-api/zambia";
		 var now = new Date();
         var today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
		 var last_respond_date = new Date(today.getFullYear(), today.getMonth()-12, today.getDate());
         var last_respond_to_date = moment(last_respond_date).format("YYYY-MM-DDTHH:mm:ss.SSS");
		 var last_three_month_output = "Last three months"
         $.ajax({
         url: textit_prefix_api + "/contacts?count=10&lastRespondedSort=1&lastRespondedTo=" + last_respond_to_date,
         success: function (lrcdata) {
         var total_lrc_contacts = lrcdata.length;
         output = '<div class="x_title"><h2>Inactive Farmers <small> -  ' + last_three_month_output + '</small></h2><div class="clearfix"></div></div><ul class="list-unstyled top_profiles scroll-view">';
         for (c=0; c < lrcdata.length; c++){
         output += '<li class="media event">' + 
         	   ' <a class="pull-left border-aero profile_thumb">' +
         		  '<i class="fa fa-user aero"></i>' +
         		'</a>' +
         		'<div class="media-body">' +
         		  '<a class="title" href="#">' + lrcdata[c].name + '</a>' +
         		  '<p><strong>Phone: </strong>' +  lrcdata[c].phone +
         		  '<p> <strong>Last Responded Date: </strong><small>' + moment(lrcdata[c].lastResponded).format('MMMM Do YYYY, h:mm:ss a') + '</small> </p>' +
         		'</div>' +
         	  '</li>';
         }
         output += '<ul>';
         $("#not_respond_contact").html(output);
         
         }
         });
			 
		/* End : Inactive Farmers - for last three months*/
			 
         
         $.ajax({
         url: textit_prefix + "/flows",
         success: function (data) {
         var total_flows = data.length;
         for (i in data) {
         if (data[i].archived){			
         	archived_flows.push(data[i].archived)
         }
         someDate = new Date(data[i].created_on);						
         if (new Date(someDate.setDate(someDate.getDate() + data[i].expires/(60*24))) > lastSunday){							
         	open_flows.push(data[i].created_on)
         }
         
         }
         
         $("#total_flows_count").html(total_flows);
         $("#archived_flows_count").html(archived_flows.length);
         $("#open_flows_count").html(open_flows.length);
         
         }
         });
         
         var total_contacts=0;
         $.ajax({
         url: textit_prefix + "/contacts",
         success: function (cdata) {
         total_contacts = cdata.length;
         
         $("#total_user_count").html(total_contacts);
         }
         });
         
         var last_contacts=0;
         $.ajax({
         url: textit_prefix + "/lastweekcontacts",
         success: function (ldata) {
         last_contacts = ldata.length;
         for (i in ldata) {
         last_week_contacts_status.push(ldata[i].uuid);
         }
         $("#last_week_user_count").html(last_contacts);
         }
         });
         
         $("#last_week_inactive_user_count").html(2437-589);
         
         $.ajax({
         url: textit_prefix + "/lastweekruns",
         success: function (rdata) {
         for (i in rdata) {
         last_week_runs_status.push(rdata[i].flow);
         }
         }
         });
         
         resend_flow = [];  
         
         $.ajax({
         url: textit_prefix + "/lastweekflowcompletion",
         success: function (lcomp) {
         lcomp_flows = lcomp.length;
         for (i in lcomp) {
         
         if (lcomp[i].flow_name.indexOf("resend") >= 0){
         	resend_flow.push(lcomp[i].flow_name);
         }					
         }
         $("#last_week_comp_flow_count").html(lcomp_flows);
           $("#last_week_comp_resend_flow_count").html(resend_flow.length);
         }
         });
         
         $.ajax({
         url: textit_prefix + "/lastweekflows",
         success: function (fdata) {
         var last_week_total_flows = fdata.length;
         for (i in fdata) {
         flow_rule_label_data = [];
         var label_data = [];
         var rule_label_data = [];					
         	completed_runs_data.push({ 
         		"y" : fdata[i].completed_runs  ,
         		"label" : '"' + fdata[i].name + '"'
         	});
         	
         	last_week_flow_status.push(fdata[i].uuid);
         	
         	total_runs_data.push({ 
         		"y" : fdata[i].runs ,
         		"label" : '"' + fdata[i].name + '"'
         	});
         	
         	more_recent_flow.push({ 
         		"total_runs" : fdata[i].runs ,
         		"name" : fdata[i].name,
         		"completed_runs" : fdata[i].completed_runs,
         		"created_on" : fdata[i].created_on,
         		"fields" : fdata[i].rulesets.length
         	});
         	for (p=0; p < fdata[i].rulesets.length; p++){	
         		flow_rule_label_data.push({"y" : 100, "label": fdata[i].rulesets[p].label})
         	}
         	if (	fdata[i].archived){			
         		last_week_archived_flows.push(fdata[i].archived)
         	}
         	lastDate = new Date(fdata[i].created_on);						
         	if (new Date(lastDate.setDate(lastDate.getDate() + fdata[i].expires/(60*24))) > lastSunday){							
         		last_week_open_flows.push(fdata[i].created_on)
         	}
         flow_rule_data.push(flow_rule_label_data);
         }
         		
         $("#last_week_flows_count").html(last_week_total_flows);
         $("#last_week_archived_flows_count").html(last_week_archived_flows.length);
         $("#last_week_open_flows_count").html(last_week_open_flows.length);
         
         
         output = '<ul class="list-unstyled top_profiles scroll-view">';
         for (m=0; m < more_recent_flow.length; m++){
         output += '<li class="media event">' + 
                              ' <a class="pull-left border-aero profile_thumb">' +
                                 '<i style="font-size:18px;font-weight:600;">' + more_recent_flow[m].total_runs + '</i>' +
         	  '<p style="padding-top:10px;">runs</p>' +
                               '</a>' +
                               '<div class="media-body">' +
                                 '<a class="title" href="#">' + more_recent_flow[m].name + '</a>' +
                                 '<p><strong>' +  more_recent_flow[m].completed_runs + '</strong> Completed runs </p>' +
                                 '<p> <small>' + more_recent_flow[m].fields + '</small> fields</p>' +
         	  '<p> <strong>created on: </strong><small>' + moment(more_recent_flow[m].created_on).format('MMMM Do YYYY, h:mm:ss a') + '</small> </p>' +
                               '</div>' +
                             '</li>';
         }
         output += '<ul>';
         $("#most_recent_flow").html(output);
         
         pie_data = [];
         pie_data_incomplete = [];
         for (m=0; m < more_recent_flow.length; m++){
         var perc = Math.round((more_recent_flow[m].completed_runs/more_recent_flow[m].total_runs)*100);
         pie_data.push({  "y": perc, "legendText": "Completed Runs", "exploded": true, "label": more_recent_flow[m].name, "val": more_recent_flow[m].completed_runs});
         pie_data_incomplete.push({   "y": 100-perc, "legendText": "In-completed Runs", "label": more_recent_flow[m].name, "val": more_recent_flow[m].total_runs - more_recent_flow[m].completed_runs});
         }
         
         pie_output = '';
         for (p=0; p < pie_data.length; p++){
         pie_output += '<div class="col-md-4 col-sm-4 col-xs-12" style="border:1px #848484 ridge;padding:10px;">' +
         '<h2 style="text-align:left;">' + pie_data[p].label.charAt(0).toUpperCase() + pie_data[p].label.slice(1) + '<h2>' +
                 '<div class="x_panel tile fixed_height_320 overflow_hidden">' +
                    '<div id="piechartContainer' + p + '"' + 'style="height: 280px; width: 100%;"></div>' +
                 '</div>' +
         '<div class="x_panel tile fixed_height_320 overflow_hidden">' +
                    '<div id="quesContainer' + p + '"' + 'style="height: 310px; width: 100%;"></div>' +
                 '</div>' +
         '<div class="x_panel tile fixed_height_320 overflow_hidden">' +
                    '<div id="runnewContainer' + p + '"' + 'style="height: 310px; width: 100%;"></div>' +
                 '</div>' +
               '</div>';
         }
         $("#pie_chart").html(pie_output);
         
         }
         });
         
         setTimeout(function () {
         status_output = '<table><tr valign="top" style="line-height:2.5;padding:10px;"><th style="padding-left:20px;font-size:13px;font-weight:400">Flows : </th>';
         if (last_week_flow_status.length != 0){ 
         status_output += '<td>&nbsp;&nbsp;&nbsp;<span class="label label-success"> Success </span></td>';
         }else{
         status_output += '<td>&nbsp;&nbsp;&nbsp;<span class="label label-warning"> Warning </span></td>';
         }
         status_output += '<th style="padding-left:20px;font-size:13px;font-weight:400" > Runs: </th>';
         
         if (last_week_runs_status.length != 0){
         status_output += '<td>&nbsp;&nbsp;&nbsp;<span class="label label-success">Success</span></td>';
         }else{
         status_output += '<td>&nbsp;&nbsp;&nbsp;<span class="label label-danger">Failure</span></td>';
         }
         status_output += '</tr><tr style="line-height:2.5;padding:10px;"><th style="padding-left:20px;font-size:13px;font-weight:400">Contacts : </th>';
         
         if (last_week_contacts_status.length != 0){
         status_output += '<td>&nbsp;&nbsp;&nbsp;<span class="label label-success">Success</span></td>';
         }else{
         status_output += '<td>&nbsp;&nbsp;&nbsp;<span class="label label-danger">Failure</span></td>';
         }
         status_output += '<th style="padding-left:20px;font-size:13px;font-weight:400">Server Status : </th>';
         
         if (last_week_runs_status.length == 0 && last_week_flow_status.length == 0 && last_week_contacts_status.length == 0){
         status_output += '<td>&nbsp;&nbsp;&nbsp;<span class="label label-danger">Failure</span></td>';
         }else if(last_week_runs_status.length != 0 && last_week_flow_status.length != 0 && last_week_contacts_status.length != 0){
         status_output += '<td>&nbsp;&nbsp;&nbsp;<span class="label label-success">Success</span></td>';
         }else{
         status_output += '<td>&nbsp;&nbsp;&nbsp;<span class="label label-warning">Warning</span></td>';
         }
         
         status_output += '</tr></table>';
         
         $("#server_status").html(status_output);	
         
         }, 1500);
         
         
         });
      </script>
      <!-- bootstrap-daterangepicker -->
      <script>
         $(document).ready(function() {
         
           var cb = function(start, end, label) {
             console.log(start.toISOString(), end.toISOString(), label);
             $('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
           };
         
           var optionSet1 = {
             startDate: moment().subtract(29, 'days'),
             endDate: moment(),
             minDate: '01/01/2012',
             maxDate: '12/31/2015',
             dateLimit: {
               days: 60
             },
             showDropdowns: true,
             showWeekNumbers: true,
             timePicker: false,
             timePickerIncrement: 1,
             timePicker12Hour: true,
             ranges: {
               'Today': [moment(), moment()],
               'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
               'Last 7 Days': [moment().subtract(6, 'days'), moment()],
               'Last 30 Days': [moment().subtract(29, 'days'), moment()],
               'This Month': [moment().startOf('month'), moment().endOf('month')],
               'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
             },
             opens: 'left',
             buttonClasses: ['btn btn-default'],
             applyClass: 'btn-small btn-primary',
             cancelClass: 'btn-small',
             format: 'MM/DD/YYYY',
             separator: ' to ',
             locale: {
               applyLabel: 'Submit',
               cancelLabel: 'Clear',
               fromLabel: 'From',
               toLabel: 'To',
               customRangeLabel: 'Custom',
               daysOfWeek: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'],
               monthNames: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
               firstDay: 1
             }
           };
           $('#reportrange span').html(moment().subtract(29, 'days').format('MMMM D, YYYY') + ' - ' + moment().format('MMMM D, YYYY'));
           $('#reportrange').daterangepicker(optionSet1, cb);
           $('#reportrange').on('show.daterangepicker', function() {
             console.log("show event fired");
           });
           $('#reportrange').on('hide.daterangepicker', function() {
             console.log("hide event fired");
           });
           $('#reportrange').on('apply.daterangepicker', function(ev, picker) {
             console.log("apply event fired, start/end dates are " + picker.startDate.format('MMMM D, YYYY') + " to " + picker.endDate.format('MMMM D, YYYY'));
           });
           $('#reportrange').on('cancel.daterangepicker', function(ev, picker) {
             console.log("cancel event fired");
           });
           $('#options1').click(function() {
             $('#reportrange').data('daterangepicker').setOptions(optionSet1, cb);
           });
           $('#options2').click(function() {
             $('#reportrange').data('daterangepicker').setOptions(optionSet2, cb);
           });
           $('#destroy').click(function() {
             $('#reportrange').data('daterangepicker').remove();
           });
         });
      </script>    
      <script type="text/javascript">
         var startDate;
         var endDate;
         
         var FromEndDate = new Date();
         var textit_prefix = "./api/zambia";
         $(document).ready(function() {
         	var today = FromEndDate;
         
         	var now = new Date();
         	var today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
         	var lastMonday = new Date(today.setDate(today.getDate()-(today.getDay()-1)%7));
         	var last_monday = new Date(lastMonday.setHours(lastMonday.getHours()+12));
         	var beforeMonday = new Date(lastMonday.getFullYear(), lastMonday.getMonth(), lastMonday.getDate()-7);
         	var before_monday = new Date(beforeMonday.setHours(beforeMonday.getHours()+12));
         	var lastbeforeMonday = new Date(lastMonday.getFullYear(), lastMonday.getMonth(), lastMonday.getDate()-14);
         	var lasttwobeforeMonday = new Date(lastMonday.getFullYear(), lastMonday.getMonth(), lastMonday.getDate()-21);
         	var lastthreebeforeMonday = new Date(lastMonday.getFullYear(), lastMonday.getMonth(), lastMonday.getDate()-28);
         	var lastfourbeforeMonday = new Date(lastMonday.getFullYear(), lastMonday.getMonth(), lastMonday.getDate()-35);
         	var last_four_before_monday = new Date(lastfourbeforeMonday.setHours(lastfourbeforeMonday.getHours()+12));
         
         	var to_date = moment(last_monday).format("YYYY-MM-DDTHH:mm:ss.SSS");
         	var from_date = moment(before_monday).format("YYYY-MM-DDTHH:mm:ss.SSS");
         	var new_from_date = from_date + "Z";
         	var new_to_date = to_date + "Z";
         
         	/* New code for first graph - Farmers Response Rate - over time */
         
         	$.ajax({
         		url: textit_prefix + "/flowcompletion?from=" + new_from_date + "&to=" + new_to_date,
         		success: function (frdata) {
         
         		flow_steps_correct_final_data = [];
         		flow_name_array = [];
         
         			for (j in frdata){
         					flow_steps_corrct_data = [];
         
         					if (frdata[j].flow_name.indexOf("harvest") >= 0 || frdata[j].flow_name.indexOf("growing") >= 0 || frdata[j].flow_name.indexOf("inter-season") >= 0 || frdata[j].flow_name.indexOf("planting") >= 0) {
         						if (frdata[j].hasOwnProperty("matrix")){
         							flow_name_array.push(frdata[j].flow_name);
         							for (q=0; q < frdata[j].matrix.length; q++){
         
         							not_ans = frdata[j].matrix[q].perc;
         							ques_label = frdata[j].matrix[q].hour;
         
         							flow_steps_corrct_data.push({"x" : ques_label, "y" : not_ans});
         							}
         						}
         						flow_steps_correct_final_data.push(flow_steps_corrct_data)
         					}
         
         			}
         
         		}
         });
         
         setTimeout(function () {
         
         if (flow_steps_correct_final_data.length == 1){
         
         var chart = new CanvasJS.Chart("chartContainer" ,
         {
           title:{
         		text: "Farmers Response Rate"
         	},
         	axisX:{
         		interval: 12,
         		title: "Time(in hours)",
         	},
         	axisY:{
         		interval: 10,
         		title: "In Percentage(%)",
         	},
         	toolTip: {
         		shared: true,
         		content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
         	},
           exportEnabled: true,
           data: [
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[0],
         	dataPoints: flow_steps_correct_final_data[0]
           }
           ],
           legend:{
         	cursor:"pointer",
         	itemclick: function(e) {
         	  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
         		  e.dataSeries.visible = false;
         	  }
         	  else
         	  {
         		e.dataSeries.visible = true;
         	  }
         	  chart.render();
         	}
           }
         });
         
         chart.render();
         
         }else if(flow_steps_correct_final_data.length == 2){
         
         	var chart = new CanvasJS.Chart("chartContainer" ,
         {
           title:{
         		text: "Farmers Response Rate"
         	},
         	axisX:{
         		interval: 12,
         		title: "Time(in hours)",
         	},
         	axisY:{
         		interval: 10,
         		title: "In Percentage(%)",
         	},
         	toolTip: {
         		shared: true,
         		content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
         
         	},
           exportEnabled: true,
           data: [
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[0],
         	dataPoints: flow_steps_correct_final_data[0]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[1],
         	dataPoints: flow_steps_correct_final_data[1]
           }
           ],
           legend:{
         	cursor:"pointer",
         	itemclick: function(e) {
         	  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
         		  e.dataSeries.visible = false;
         	  }
         	  else
         	  {
         		e.dataSeries.visible = true;
         	  }
         	  chart.render();
         	}
           }
         });
         
         chart.render();
         
         
         }else if(flow_steps_correct_final_data.length == 3){
         
         	var chart = new CanvasJS.Chart("chartContainer" ,
         {
           title:{
         		text: "Farmers Response Rate"
         	},
         	axisX:{
         		interval: 12,
         		title: "Time(in hours)",
         	},
         	axisY:{
         		interval: 10,
         		title: "In Percentage(%)",
         	},
         	toolTip: {
         		shared: true,
         		content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
         	},
           exportEnabled: true,
           data: [
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[0],
         	dataPoints: flow_steps_correct_final_data[0]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[1],
         	dataPoints: flow_steps_correct_final_data[1]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[2],
         	dataPoints: flow_steps_correct_final_data[2]
           }
           ],
           legend:{
         	cursor:"pointer",
         	itemclick: function(e) {
         	  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
         		  e.dataSeries.visible = false;
         	  }
         	  else
         	  {
         		e.dataSeries.visible = true;
         	  }
         	  chart.render();
         	}
           }
         });
         
         chart.render();
         
         }else if (flow_steps_correct_final_data.length == 4){
         
         	var chart = new CanvasJS.Chart("chartContainer" ,
         {
           title:{
         		text: "Farmers Response Rate"
         	},
         	axisX:{
         		interval: 12,
         		title: "Time(in hours)",
         	},
         	axisY:{
         		interval: 10,
         		title: "In Percentage(%)",
         	},
         	toolTip: {
         		shared: true,
         		content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
         	},
           exportEnabled: true,
           data: [
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[0],
         	dataPoints: flow_steps_correct_final_data[0]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[1],
         	dataPoints: flow_steps_correct_final_data[1]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[2],
         	dataPoints: flow_steps_correct_final_data[2]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[3],
         	dataPoints: flow_steps_correct_final_data[3]
           }
           ],
           legend:{
         	cursor:"pointer",
         	itemclick: function(e) {
         	  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
         		  e.dataSeries.visible = false;
         	  }
         	  else
         	  {
         		e.dataSeries.visible = true;
         	  }
         	  chart.render();
         	}
           }
         });
         
         chart.render();
         
         }else{
         	var chart = new CanvasJS.Chart("chartContainer" ,
         	{
           	title:{
         		text: "No valid data available within this date range",
         		fontColor: "#2f4f4f",
         		fontSize: 30,
         		padding: 10,
         		margin: 15,
         		backgroundColor: "#FFFFE0",
         		borderThickness: 1,
         		cornerRadius: 5,
         		fontWeight: "bold",
         		verticalAlign: "center"
         	},
         	axisX:{
         		interval: 12,
         		title: "Time(in hours)",
         	},
         	axisY:{
         		interval: 10,
         		title: "In Percentage(%)",
         	},
         	toolTip: {
         		shared: true
         	},
             exportEnabled: true,
             data: [
             {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: null,
         	dataPoints: null
           }
           ],
           legend:{
         	cursor:"pointer",
         	itemclick: function(e) {
         	  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
         		  e.dataSeries.visible = false;
         	  }
         	  else
         	  {
         		e.dataSeries.visible = true;
         	  }
         	  chart.render();
         	}
           }
         });
         
         chart.render();
         }
         
          }, 1500);
         
          /*  ##### */
         
         /* 2nd graph - File sizes by type per week - over time */
         
         /* ############ */
         
         /* 3rd graph - Number of farmers indicated yes/no to the “Did it rain…” question - over time */
         ques_type = "rain";
         var st_date = new Date("09/28/2015");
         var stat_date = moment(new Date(st_date.setHours(st_date.getHours()+12))).format("YYYY-MM-DDTHH:mm:ss.SSS");
         var new_stat_date = stat_date + "Z";
         
         $.ajax({
         //url: textit_prefix + "/questionanalysis?type=" + ques_type + "&from=" + new_stat_date + "&to=" + new_to_date,
         url: textit_prefix + "/questionanalysis?type=" + ques_type + "&from=" + new_from_date + "&to=" + new_to_date,
         success: function (quesdata) {
         
         rain_yes_array = [];
         rain_no_array = [];
         other_rain_array = [];
         
         	for (qrain in quesdata){
         		week_label = quesdata[qrain].day;
         		total = quesdata[qrain].matrix[0].count + quesdata[qrain].matrix[1].count + quesdata[qrain].matrix[2].count;
         		for(irain=0; irain < quesdata[qrain].matrix.length; irain++){
         			if (quesdata[qrain].matrix[irain].anw == "No"){
         				rain_no_array.push({"label" : week_label, "y" : Math.round((quesdata[qrain].matrix[irain].count/total)*100), "cat_name" : "no"});
         			}else if (quesdata[qrain].matrix[irain].anw == "Yes"){
         				rain_yes_array.push({"label" : week_label, "y" : Math.round((quesdata[qrain].matrix[irain].count/total)*100), "cat_name" : "yes"});
         			}else if (quesdata[qrain].matrix[irain].anw == "Other"){
         				other_rain_array.push({"label" : week_label, "y" : Math.round((quesdata[qrain].matrix[irain].count/total)*100), "cat_name" : "other"});
         			}
         		}
         	}
         
         }
         });
         
         setTimeout(function () {
         var chart = new CanvasJS.Chart("chartContainer2",
         	{
         		title:{
         			text: "Did it rain on your fields in the last 7 days?"
         		},
         		toolTip: {
         			shared: true
         		},
         		axisY: {
         			title: "Percentage of farmers",
         			maximum: 100,
         		},
         		axisX: {
         		title: "Time (in weeks)",
         		interval: 1,
         		labelFontSize: 12,
         		labelAngle : -20
         		},
         		exportEnabled: true,
         		data: [
         		{
         			type: "column",
         			name: "Yes",
         			legendText: "Yes",
         			showInLegend: true,
         			dataPoints: rain_yes_array
         		},
         		{
         			type: "column",
         			name: "No",
         			legendText: "No",
         			showInLegend: true,
         			dataPoints: rain_no_array
         		},
         		{
         			type: "column",
         			name: "Other Response",
         			legendText: "Other Response",
         			showInLegend: true,
         			dataPoints: other_rain_array
         		}
         
         		],
         	  legend:{
         		cursor:"pointer",
         		itemclick: function(e){
         		  if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
         			e.dataSeries.visible = false;
         		  }
         		  else {
         			e.dataSeries.visible = true;
         		  }
         			chart.render();
         		}
         	  },
         	});
         
         chart.render();
         
         }, 2000);
         
         /* ######## */
         
         /* 4th graph - Analysis of Responses for the "expected harves" Type Questions */
         var harvest_ques_type = "expected%2520harvest";
         var st_date = new Date("09/28/2015");
         var stat_date = moment(new Date(st_date.setHours(st_date.getHours()+12))).format("YYYY-MM-DDTHH:mm:ss.SSS");
         var new_stat_date = stat_date + "Z";
         
         $.ajax({
         //url: textit_prefix + "/questionanalysis?type=" + harvest_ques_type + "&from=" + new_stat_date + "&to=" + new_to_date,
         url: textit_prefix + "/questionanalysis?type=" + harvest_ques_type + "&from=" + new_from_date + "&to=" + new_to_date,
         success: function (quesdata) {
         
         harvest_numeric_array = [];
         harvest_other_array = [];
         
         	for (qharv in quesdata){
         		harvest_week_label = quesdata[qharv].day;
         		harv_total = quesdata[qharv].matrix[0].count + quesdata[qharv].matrix[1].count;
         		for(iharv =0; iharv < quesdata[qharv].matrix.length; iharv++){
         			if (quesdata[qharv].matrix[iharv].anw == "numeric"){
         				harvest_numeric_array.push({"label" : harvest_week_label, "y" : Math.round((quesdata[qharv].matrix[iharv].count/harv_total)*100), "cat_name" : "numeric_value"});
         			}else if (quesdata[qharv].matrix[iharv].anw == "Other"){
         				harvest_other_array.push({"label" : harvest_week_label, "y" : Math.round((quesdata[qharv].matrix[iharv].count)/harv_total*100), "cat_name" : "other_response"});
         			}
         		}
         	}
         
         }
         });
         
         setTimeout(function () {
         var chart = new CanvasJS.Chart("chartContainer3",
         	{
         		title:{
         			text: "Did you harvest any of your maize fields in the last 7 days?"
         		},
         		toolTip: {
         			shared: true
         		},
         		axisY: {
         			title: "Percentage of farmers",
         			maximum: 100,
         		},
         		axisX: {
         		title: "Time (in weeks)",
         		interval: 1,
         		labelFontSize: 12,
         		labelAngle : -20
         		},
         		exportEnabled: true,
         		data: [
         		{
         			type: "column",
         			name: "Numeric",
         			legendText: "Numeric",
         			showInLegend: true,
         			dataPoints: harvest_numeric_array
         		},
         		{
         			type: "column",
         			name: "Other Response",
         			legendText: "Other Response",
         			showInLegend: true,
         			dataPoints: harvest_other_array
         		}
         
         		],
         	  legend:{
         		cursor:"pointer",
         		itemclick: function(e){
         		  if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
         			e.dataSeries.visible = false;
         		  }
         		  else {
         			e.dataSeries.visible = true;
         		  }
         			chart.render();
         		}
         	  },
         	});
         
         chart.render();
         
         }, 2000);
         
         /* ######## */
         
         
         /* 5th graph - Analysis of Responses for the "storage" Type Questions */
         var storage_ques_type = "storage";
         var st_date = new Date("09/28/2015");
         var stat_date = moment(new Date(st_date.setHours(st_date.getHours()+12))).format("YYYY-MM-DDTHH:mm:ss.SSS");
         var new_stat_date = stat_date + "Z";
         
         $.ajax({
         //url: textit_prefix + "/questionanalysis?type=" + storage_ques_type + "&from=" + new_stat_date + "&to=" + new_to_date,
         url: textit_prefix + "/questionanalysis?type=" + storage_ques_type + "&from=" + new_from_date + "&to=" + new_to_date,
         success: function (quesdata) {
         
         st_numeric_array = [];
         st_other_array = [];
         
         	for (qst in quesdata){
         		st_week_label = quesdata[qst].day;
         		st_total = quesdata[qst].matrix[0].count + quesdata[qst].matrix[1].count;
         		for(ist=0; ist < quesdata[qst].matrix.length; ist++){
         			if (quesdata[qst].matrix[ist].anw == "numeric"){
         				st_numeric_array.push({"label" : week_label, "y" : Math.round((quesdata[qst].matrix[ist].count/st_total)*100), "cat_name" : "numeric_value"});
         			}else if (quesdata[qst].matrix[ist].anw == "Other"){
         				st_other_array.push({"label" : week_label, "y" : Math.round((quesdata[qst].matrix[ist].count/st_total)*100), "cat_name" : "other_response"});
         			}
         		}
         	}
         
         }
         });
         
         setTimeout(function () {
         var chart = new CanvasJS.Chart("chartContainer4",
         	{
         		title:{
         			text: "How many 50kg bags of maize do you have in storage now?"
         		},
         		toolTip: {
         			shared: true
         		},
         		axisY: {
         			title: "Percentage of farmers",
         			maximum: 100,
         		},
         		axisX: {
         		title: "Time (in weeks)",
         		interval: 1,
         		labelFontSize: 12,
         		labelAngle : -20
         		},
         		exportEnabled: true,
         		data: [
         		{
         			type: "column",
         			name: "Numeric",
         			legendText: "Numeric",
         			showInLegend: true,
         			dataPoints: st_numeric_array
         		},
         		{
         			type: "column",
         			name: "Other Response",
         			legendText: "Other Response",
         			showInLegend: true,
         			dataPoints: st_other_array
         		}
         
         		],
         	  legend:{
         		cursor:"pointer",
         		itemclick: function(e){
         		  if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
         			e.dataSeries.visible = false;
         		  }
         		  else {
         			e.dataSeries.visible = true;
         		  }
         			chart.render();
         		}
         	  },
         	});
         
         chart.render();
         
         }, 2000);
         
         /* ######## */
         
         /* code for after choose date or dropdown option and then click the submit function */
         /* For first graph */
           $('#reportrange').daterangepicker(
              {
                 startDate: beforeMonday,
                 endDate: lastMonday,
                 minDate: '20/06/2016',
                 maxDate: FromEndDate,
                 //dateLimit: { days: 60 },
                 showDropdowns: true,
                 showWeekNumbers: true,
                 timePicker: false,
                 timePickerIncrement: 1,
                 timePicker12Hour: true,
                 ranges: {
                    //'Today': [moment(), moment()],
                    //'Yesterday': [moment().subtract('days', 1), moment().subtract('days', 1)],
                    'Last Week': [moment(beforeMonday), moment(lastMonday)],
         	 'Last 2 Weeks' : [moment(lastbeforeMonday), moment(lastMonday)],
                    'Last 3 Weeks': [moment(lasttwobeforeMonday), moment(lastMonday)],
         	 'Last 4 Weeks': [moment(lastthreebeforeMonday), moment(lastMonday)],
                    'This Month': [moment().startOf('month'), moment().endOf('month')],
                    'Last Month': [moment().subtract('month', 1).startOf('month'), moment().subtract('month', 1).endOf('month')]
                 },
                 opens: 'left',
                 buttonClasses: ['btn btn-default'],
                 applyClass: 'btn-small btn-primary',
                 cancelClass: 'btn-small',
                 format: 'DD/MM/YYYY',
                 separator: ' to ',
                 locale: {
                     applyLabel: 'Submit',
                     fromLabel: 'From',
                     toLabel: 'To',
                     customRangeLabel: 'Custom Range',
                     daysOfWeek: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr','Sa'],
                     monthNames: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
                     firstDay: 1
                 }
              },
              function(start, end) {
               console.log("Callback has been called!");
               $('#reportrange span').html(start.format('D MMMM YYYY') + ' - ' + end.format('D MMMM YYYY'));
               startDate = start;
               endDate = end;
         
              }
           );
           //Set the initial state of the picker label
           $('#reportrange span').html(moment(beforeMonday).format('D MMMM YYYY') + ' - ' + moment(lastMonday).format('D MMMM YYYY'));
         
           $('#saveBtn').click(function(){
         from_date = startDate.format("YYYY-MM-DDTHH:mm:ss.SSS");
         to_date = endDate.format("YYYY-MM-DDTHH:mm:ss.SSS");
         
         new_end_date = new Date(endDate);
         new_end_date_sr = new Date(new_end_date.setHours(new_end_date.getHours()-12))
         new_end_date_sr_lk = moment(new_end_date_sr).format("YYYY-MM-DDTHH:mm:ss.SSS");
         
         new_start_date = new Date(startDate);
         new_start_date_sr = new Date(new_start_date.setHours(new_start_date.getHours()+12))
         new_start_date_sr_lk = moment(new_start_date_sr).format("YYYY-MM-DDTHH:mm:ss.SSS");
         
         var new_from_date = new_start_date_sr_lk + "Z";
         var new_to_date = new_end_date_sr_lk + "Z";
         
         $.ajax({
         		url: textit_prefix + "/flowcompletion?from=" + new_from_date + "&to=" + new_to_date,
         		success: function (frdata) {
         
         		response_final_data = [];
         		flow_name_array = [];
         
         			for (j in frdata){
         
         					if (frdata[j].flow_name.indexOf("harvest") >= 0 || frdata[j].flow_name.indexOf("growing") >= 0 || frdata[j].flow_name.indexOf("inter-season") >= 0 || frdata[j].flow_name.indexOf("planting") >= 0) {
         
         						if (frdata[j].hasOwnProperty("matrix")){
         							flow_steps_data = [];
         							flow_steps_corrct_data = [];
         							flow_name_array.push(frdata[j].flow_name);
         							for (q=0; q < frdata[j].matrix.length; q++){
         
         								not_ans = frdata[j].matrix[q].perc;
         								ques_label = frdata[j].matrix[q].hour;
         
         								flow_steps_corrct_data.push({"x" : ques_label, "y" : not_ans});
         							}
         							response_final_data.push(flow_steps_corrct_data)
         						}
         					}
         			}
         		}
         });
         
         
         setTimeout(function () {
         
         if (response_final_data.length == 1){
         
         var chart = new CanvasJS.Chart("chartContainer" ,
         {
           title:{
         		text: "Farmers Response Rate"
         	},
         	axisX:{
         		interval: 12,
         		title: "Time(in hours)",
         	},
         	axisY:{
         		interval: 10,
         		title: "In Percentage(%)",
         	},
         	toolTip: {
         		shared: true,
         		content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
         	},
           exportEnabled: true,
           data: [
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[0],
         	dataPoints: response_final_data[0]
           }
           ],
           legend:{
         	cursor:"pointer",
         	itemclick: function(e) {
         	  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
         		  e.dataSeries.visible = false;
         	  }
         	  else
         	  {
         		e.dataSeries.visible = true;
         	  }
         	  chart.render();
         	}
           }
         });
         
         chart.render();
         
         }else if(response_final_data.length == 2){
         
         	var chart = new CanvasJS.Chart("chartContainer" ,
         {
           title:{
         		text: "Farmers Response Rate"
         	},
         	axisX:{
         		interval: 12,
         		title: "Time(in hours)",
         	},
         	axisY:{
         		interval: 10,
         		title: "In Percentage(%)",
         	},
         	toolTip: {
         		shared: true,
         		content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
         	},
           exportEnabled: true,
           data: [
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[0],
         	dataPoints: response_final_data[0]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[1],
         	dataPoints: response_final_data[1]
           }
           ],
           legend:{
         	cursor:"pointer",
         	itemclick: function(e) {
         	  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
         		  e.dataSeries.visible = false;
         	  }
         	  else
         	  {
         		e.dataSeries.visible = true;
         	  }
         	  chart.render();
         	}
           }
         });
         
         chart.render();
         
         
         }else if(response_final_data.length == 3){
         
         	var chart = new CanvasJS.Chart("chartContainer" ,
         {
           title:{
         		text: "Farmers Response Rate"
         	},
         	axisX:{
         		interval: 12,
         		title: "Time(in hours)"
         	},
         	axisY:{
         		interval: 10,
         		title: "In Percentage(%)"
         	},
         	toolTip: {
         		shared: true,
         		content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
         	},
           exportEnabled: true,
           data: [
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[0],
         	dataPoints: response_final_data[0]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[1],
         	dataPoints: response_final_data[1]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[2],
         	dataPoints: response_final_data[2]
           }
           ],
           legend:{
         	cursor:"pointer",
         	itemclick: function(e) {
         	  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
         		  e.dataSeries.visible = false;
         	  }
         	  else
         	  {
         		e.dataSeries.visible = true;
         	  }
         	  chart.render();
         	}
           }
         });
         
         chart.render();
         
         }else if (response_final_data.length == 4){
         
         	var chart = new CanvasJS.Chart("chartContainer" ,
         {
           title:{
         		text: "Farmers Response Rate"
         	},
         	axisX:{
         		interval: 12,
         		title: "Time(in hours)",
         	},
         	axisY:{
         		interval: 10,
         		title: "In Percentage(%)",
         	},
         	toolTip: {
         		shared: true,
         		content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
         	},
           exportEnabled: true,
           data: [
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[0],
         	dataPoints: response_final_data[0]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[1],
         	dataPoints: response_final_data[1]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[2],
         	dataPoints: response_final_data[2]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[3],
         	dataPoints: response_final_data[3]
           }
           ],
           legend:{
         	cursor:"pointer",
         	itemclick: function(e) {
         	  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
         		  e.dataSeries.visible = false;
         	  }
         	  else
         	  {
         		e.dataSeries.visible = true;
         	  }
         	  chart.render();
         	}
           }
         });
         
         chart.render();
         
         }else if (response_final_data.length == 5){
         
         	var chart = new CanvasJS.Chart("chartContainer" ,
         {
           title:{
         		text: "Farmers Response Rate"
         	},
         	axisX:{
         		interval: 12,
         		title: "Time(in hours)",
         	},
         	axisY:{
         		interval: 10,
         		title: "In Percentage(%)",
         	},
         	toolTip: {
         		shared: true,
         		content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
         	},
           exportEnabled: true,
           data: [
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[0],
         	dataPoints: response_final_data[0]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[1],
         	dataPoints: response_final_data[1]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[2],
         	dataPoints: response_final_data[2]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[3],
         	dataPoints: response_final_data[3]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[4],
         	dataPoints: response_final_data[4]
           }
           ],
           legend:{
         	cursor:"pointer",
         	itemclick: function(e) {
         	  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
         		  e.dataSeries.visible = false;
         	  }
         	  else
         	  {
         		e.dataSeries.visible = true;
         	  }
         	  chart.render();
         	}
           }
         });
         
         chart.render();
         
         }else if(response_final_data.length == 6){
         		var chart = new CanvasJS.Chart("chartContainer" ,
         {
           title:{
         		text: "Farmers Response Rate"
         	},
         	axisX:{
         		interval: 12,
         		title: "Time(in hours)",
         	},
         	axisY:{
         		interval: 10,
         		title: "In Percentage(%)",
         	},
         	toolTip: {
         		shared: true,
         		content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
         	},
           exportEnabled: true,
           data: [
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[0],
         	dataPoints: response_final_data[0]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[1],
         	dataPoints: response_final_data[1]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[2],
         	dataPoints: response_final_data[2]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[3],
         	dataPoints: response_final_data[3]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[4],
         	dataPoints: response_final_data[4]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[5],
         	dataPoints: response_final_data[5]
           }
           ],
           legend:{
         	cursor:"pointer",
         	itemclick: function(e) {
         	  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
         		  e.dataSeries.visible = false;
         	  }
         	  else
         	  {
         		e.dataSeries.visible = true;
         	  }
         	  chart.render();
         	}
           }
         });
         
         chart.render();
         
         }else if(response_final_data.length == 7){
         		var chart = new CanvasJS.Chart("chartContainer" ,
         {
           title:{
         		text: "Farmers Response Rate"
         	},
         	axisX:{
         		interval: 12,
         		title: "Time(in hours)",
         	},
         	axisY:{
         		interval: 10,
         		title: "In Percentage(%)",
         	},
         	toolTip: {
         		shared: true,
         		content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
         	},
           exportEnabled: true,
           data: [
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[0],
         	dataPoints: response_final_data[0]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[1],
         	dataPoints: response_final_data[1]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[2],
         	dataPoints: response_final_data[2]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[3],
         	dataPoints: response_final_data[3]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[4],
         	dataPoints: response_final_data[4]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[5],
         	dataPoints: response_final_data[5]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[6],
         	dataPoints: response_final_data[6]
           }
           ],
           legend:{
         	cursor:"pointer",
         	itemclick: function(e) {
         	  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
         		  e.dataSeries.visible = false;
         	  }
         	  else
         	  {
         		e.dataSeries.visible = true;
         	  }
         	  chart.render();
         	}
           }
         });
         
         chart.render();
         
         }else if(response_final_data.length == 8){
         		var chart = new CanvasJS.Chart("chartContainer" ,
         {
           title:{
         		text: "Farmers Response Rate"
         	},
         	axisX:{
         		interval: 12,
         		title: "Time(in hours)",
         	},
         	axisY:{
         		interval: 10,
         		title: "In Percentage(%)",
         	},
         	toolTip: {
         		shared: true,
         		content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
         	},
           exportEnabled: true,
           data: [
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[0],
         	dataPoints: response_final_data[0]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[1],
         	dataPoints: response_final_data[1]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[2],
         	dataPoints: response_final_data[2]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[3],
         	dataPoints: response_final_data[3]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[4],
         	dataPoints: response_final_data[4]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[5],
         	dataPoints: response_final_data[5]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[6],
         	dataPoints: response_final_data[6]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[7],
         	dataPoints: response_final_data[7]
           }
           ],
           legend:{
         	cursor:"pointer",
         	itemclick: function(e) {
         	  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
         		  e.dataSeries.visible = false;
         	  }
         	  else
         	  {
         		e.dataSeries.visible = true;
         	  }
         	  chart.render();
         	}
           }
         });
         
         chart.render();
         
         }else if(response_final_data.length == 9){
         		var chart = new CanvasJS.Chart("chartContainer" ,
         {
           title:{
         		text: "Farmers Response Rate"
         	},
         	axisX:{
         		interval: 12,
         		title: "Time(in hours)",
         	},
         	axisY:{
         		interval: 10,
         		title: "In Percentage(%)",
         	},
         	toolTip: {
         		shared: true,
         		content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
         	},
           exportEnabled: true,
           data: [
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[0],
         	dataPoints: response_final_data[0]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[1],
         	dataPoints: response_final_data[1]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[2],
         	dataPoints: response_final_data[2]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[3],
         	dataPoints: response_final_data[3]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[4],
         	dataPoints: response_final_data[4]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[5],
         	dataPoints: response_final_data[5]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[6],
         	dataPoints: response_final_data[6]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[7],
         	dataPoints: response_final_data[7]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[8],
         	dataPoints: response_final_data[8]
           }
           ],
           legend:{
         	cursor:"pointer",
         	itemclick: function(e) {
         	  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
         		  e.dataSeries.visible = false;
         	  }
         	  else
         	  {
         		e.dataSeries.visible = true;
         	  }
         	  chart.render();
         	}
           }
         });
         
         chart.render();
         
         }else if(response_final_data.length == 10){
         		var chart = new CanvasJS.Chart("chartContainer" ,
         {
           title:{
         		text: "Farmers Response Rate"
         	},
         	axisX:{
         		interval: 12,
         		title: "Time(in hours)",
         	},
         	axisY:{
         		interval: 10,
         		title: "In Percentage(%)",
         	},
         	toolTip: {
         		shared: true,
         		content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
         	},
           exportEnabled: true,
           data: [
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[0],
         	dataPoints: response_final_data[0]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[1],
         	dataPoints: response_final_data[1]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[2],
         	dataPoints: response_final_data[2]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[3],
         	dataPoints: response_final_data[3]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[4],
         	dataPoints: response_final_data[4]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[5],
         	dataPoints: response_final_data[5]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[6],
         	dataPoints: response_final_data[6]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[7],
         	dataPoints: response_final_data[7]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[8],
         	dataPoints: response_final_data[8]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[9],
         	dataPoints: response_final_data[9]
           }
           ],
           legend:{
         	cursor:"pointer",
         	itemclick: function(e) {
         	  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
         		  e.dataSeries.visible = false;
         	  }
         	  else
         	  {
         		e.dataSeries.visible = true;
         	  }
         	  chart.render();
         	}
           }
         });
         
         chart.render();
         
         }else if(response_final_data.length == 11){
         		var chart = new CanvasJS.Chart("chartContainer" ,
         {
           title:{
         		text: "Farmers Response Rate"
         	},
         	axisX:{
         		interval: 12,
         		title: "Time(in hours)",
         	},
         	axisY:{
         		interval: 10,
         		title: "In Percentage(%)",
         	},
         	toolTip: {
         		shared: true,
         		content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
         	},
           exportEnabled: true,
           data: [
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[0],
         	dataPoints: response_final_data[0]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[1],
         	dataPoints: response_final_data[1]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[2],
         	dataPoints: response_final_data[2]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[3],
         	dataPoints: response_final_data[3]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[4],
         	dataPoints: response_final_data[4]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[5],
         	dataPoints: response_final_data[5]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[6],
         	dataPoints: response_final_data[6]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[7],
         	dataPoints: response_final_data[7]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[8],
         	dataPoints: response_final_data[8]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[9],
         	dataPoints: response_final_data[9]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[10],
         	dataPoints: response_final_data[10]
           }
           ],
           legend:{
         	cursor:"pointer",
         	itemclick: function(e) {
         	  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
         		  e.dataSeries.visible = false;
         	  }
         	  else
         	  {
         		e.dataSeries.visible = true;
         	  }
         	  chart.render();
         	}
           }
         });
         
         chart.render();
         
         }else if(response_final_data.length == 12){
         		var chart = new CanvasJS.Chart("chartContainer" ,
         {
           title:{
         		text: "Farmers Response Rate"
         	},
         	axisX:{
         		interval: 12,
         		title: "Time(in hours)",
         	},
         	axisY:{
         		interval: 10,
         		title: "In Percentage(%)",
         	},
         	toolTip: {
         		shared: true,
         		content: "<span style='\"'color: {color};'\"'>{name}:</span> {y}%"
         	},
           exportEnabled: true,
           data: [
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[0],
         	dataPoints: response_final_data[0]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[1],
         	dataPoints: response_final_data[1]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[2],
         	dataPoints: response_final_data[2]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[3],
         	dataPoints: response_final_data[3]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[4],
         	dataPoints: response_final_data[4]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[5],
         	dataPoints: response_final_data[5]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[6],
         	dataPoints: response_final_data[6]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[7],
         	dataPoints: response_final_data[7]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[8],
         	dataPoints: response_final_data[8]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[9],
         	dataPoints: response_final_data[9]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[10],
         	dataPoints: response_final_data[10]
           },
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: flow_name_array[11],
         	dataPoints: response_final_data[11]
           }
           ],
           legend:{
         	cursor:"pointer",
         	itemclick: function(e) {
         	  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
         		  e.dataSeries.visible = false;
         	  }
         	  else
         	  {
         		e.dataSeries.visible = true;
         	  }
         	  chart.render();
         	}
           }
         });
         
         chart.render();
         
         }else{
         	var chart = new CanvasJS.Chart("chartContainer" ,
         {
           title:{
         		text: "No valid data available within this date range",
         		fontColor: "#2f4f4f",
         		fontSize: 30,
         		padding: 10,
         		margin: 15,
         		backgroundColor: "#FFFFE0",
         		borderThickness: 1,
         		cornerRadius: 5,
         		fontWeight: "bold",
         		verticalAlign: "center"
         	},
         	axisX:{
         		interval: 12,
         		title: "Time(in hours)",
         	},
         	axisY:{
         		interval: 10,
         		title: "In Percentage(%)",
         	},
         	toolTip: {
         		shared: true
         	},
           exportEnabled: true,
           data: [
           {
         	type: "line",
         	lineThickness:3,
         	showInLegend: "true",
         	name: "",
         	dataPoints: null
           }
           ],
           legend:{
         	cursor:"pointer",
         	itemclick: function(e) {
         	  if (typeof (e.dataSeries.visible) ===  "undefined" || e.dataSeries.visible) {
         		  e.dataSeries.visible = false;
         	  }
         	  else
         	  {
         		e.dataSeries.visible = true;
         	  }
         	  chart.render();
         	}
           }
         });
         
         chart.render();
         }
         
          }, 1000);
         
           });
         /* ########## */
         
         /* 2nd graph */
         
         
         /* ################# */
         
         /* 3rd graph */
         $( "#from, #to" ).datepicker({
                   defaultDate: "+1w",
                   changeMonth: true,
         	beforeShowDay: noSunday,
         	minDate: "09/28/2015",
         	maxDate: new Date(),
                   numberOfMonths: 2,
                   onSelect: function( selectedDate ) {
                       if(this.id == 'from'){
                         var dateMin = $('#from').datepicker("getDate");
                         var rMin = new Date(dateMin.getFullYear(), dateMin.getMonth(),dateMin.getDate() + 1);
                         $('#to').datepicker("option","minDate",rMin);
                       }if(this.id == 'to'){
                         var dateMax = $('#to').datepicker("getDate");
                         var toMax = new Date(dateMax.getFullYear(), dateMax.getMonth(),dateMax.getDate()-1);
                         $('#from').datepicker("option","maxDate",toMax);
                       }
         
                   }
               });
         
         function noSunday(date) {
         var day = date.getDay();
         return [(day == 1), ''];
         };
         
           //Set the initial state of the picker label
         $('#from').val(moment(beforeMonday).format('D MMMM YYYY'));
         $('#to').val(moment(lastMonday).format('D MMMM YYYY'));
         
         $('#saveBtn2').click(function(){
         
         from_date = $('#from').val();
         to_date = $('#to').val();
         
         new_end_date = new Date(to_date);
         new_end_date_sr = new Date(new_end_date.setHours(new_end_date.getHours()+12))
         new_end_date_sr_lk = moment(new_end_date_sr).format("YYYY-MM-DDTHH:mm:ss.SSS");
         
         new_start_date = new Date(from_date);
         new_start_date_sr = new Date(new_start_date.setHours(new_start_date.getHours()+12))
         new_start_date_sr_lk = moment(new_start_date_sr).format("YYYY-MM-DDTHH:mm:ss.SSS");
         
         var new_from_date = new_start_date_sr_lk + "Z";
         var new_to_date = new_end_date_sr_lk + "Z";
         
         $.ajax({
         url: textit_prefix + "/questionanalysis?type=" + ques_type + "&from=" + new_from_date + "&to=" + new_to_date,
         success: function (quesdata) {
         
         rain_range_yes_array = [];
         rain_range_no_array = [];
         rain_range_other_array = [];
         
         	for (qrainrange in quesdata){
         		rain_range_week_label = quesdata[qrainrange].day;
         		total = quesdata[qrainrange].matrix[0].count + quesdata[qrainrange].matrix[1].count + quesdata[qrainrange].matrix[2].count;
         		for(irainrange=0; irainrange < quesdata[qrainrange].matrix.length; irainrange++){
         
         
         			if (quesdata[qrainrange].matrix[irainrange].anw == "No"){
         				rain_range_no_array.push({"label" : rain_range_week_label, "y" : Math.round((quesdata[qrainrange].matrix[irainrange].count/total)*100), "cat_name" : "no"});
         			}else if (quesdata[qrainrange].matrix[irainrange].anw == "Yes"){
         				rain_range_yes_array.push({"label" : rain_range_week_label, "y" : Math.round((quesdata[qrainrange].matrix[irainrange].count/total)*100), "cat_name" : "yes"});
         			}else if (quesdata[qrainrange].matrix[irainrange].anw == "Other"){
         				rain_range_other_array.push({"label" : rain_range_week_label, "y" : Math.round((quesdata[qrainrange].matrix[irainrange].count/total)*100), "cat_name" : "other_response"});
         			}
         		}
         	}
         
         }
         });
         
         setTimeout(function () {
         var chart = new CanvasJS.Chart("chartContainer2",
         {
         	title:{
         		text: "Did it rain on your fields in the last 7 days?",
         		fontSize: 30
         	},
         	toolTip: {
         		shared: true
         	},
         	axisY: {
         		title: "Percentage of farmers",
         		maximum: 100
         	},
         	axisX: {
         		title: "Time (in weeks)",
         		interval: 1,
         		labelFontSize: 12,
         		labelAngle : -20
         	},
         	exportEnabled: true,
         	data: [
         	{
         		type: "column",
         		name: "Yes",
         		legendText: "Yes",
         		showInLegend: true,
         		dataPoints: rain_range_yes_array
         	},
         	{
         		type: "column",
         		name: "No",
         		legendText: "No",
         		showInLegend: true,
         		dataPoints: rain_range_no_array
         	},
         	{
         		type: "column",
         		name: "Other Response",
         		legendText: "Other Response",
         		showInLegend: true,
         		dataPoints: rain_range_other_array
         	}
         
         	],
                 legend:{
                   cursor:"pointer",
                   itemclick: function(e){
                     if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                     	e.dataSeries.visible = false;
                     }
                     else {
                       e.dataSeries.visible = true;
                     }
                   	chart.render();
                   }
                 },
               });
         
         chart.render();
         
         }, 2000);
         
         });
         
         /* ############### */
         
         
         /* 4th graph */
         $( "#from1, #to1" ).datepicker({
                   defaultDate: "+1w",
                   changeMonth: true,
         	beforeShowDay: noSunday,
         	minDate: "09/28/2015",
         	maxDate: new Date(),
                   numberOfMonths: 2,
                   onSelect: function( selectedDate ) {
                       if(this.id == 'from1'){
                         var dateMin = $('#from1').datepicker("getDate");
                         var rMin = new Date(dateMin.getFullYear(), dateMin.getMonth(),dateMin.getDate() + 1);
                         $('#to1').datepicker("option","minDate",rMin);
                       }if(this.id == 'to1'){
                         var dateMax = $('#to1').datepicker("getDate");
                         var toMax = new Date(dateMax.getFullYear(), dateMax.getMonth(),dateMax.getDate()-1);
                         $('#from1').datepicker("option","maxDate",toMax);
                       }
         
                   }
               });
         
         function noSunday(date) {
         var day = date.getDay();
         return [(day == 1), ''];
         };
         
           //Set the initial state of the picker label
         $('#from1').val(moment(beforeMonday).format('D MMMM YYYY'));
         $('#to1').val(moment(lastMonday).format('D MMMM YYYY'));
         var harvest_ques_type = "expected%2520harvest";
         $('#saveBtn3').click(function(){
         
         from_date = $('#from1').val();
         to_date = $('#to1').val();
         
         new_end_date = new Date(to_date);
         new_end_date_sr = new Date(new_end_date.setHours(new_end_date.getHours()+12))
         new_end_date_sr_lk = moment(new_end_date_sr).format("YYYY-MM-DDTHH:mm:ss.SSS");
         
         new_start_date = new Date(from_date);
         new_start_date_sr = new Date(new_start_date.setHours(new_start_date.getHours()+12))
         new_start_date_sr_lk = moment(new_start_date_sr).format("YYYY-MM-DDTHH:mm:ss.SSS");
         
         var new_from_date = new_start_date_sr_lk + "Z";
         var new_to_date = new_end_date_sr_lk + "Z";
         
         $.ajax({
         url: textit_prefix + "/questionanalysis?type=" + harvest_ques_type + "&from=" + new_from_date + "&to=" + new_to_date,
         success: function (quesdata) {
         
         
         hrange_numeric_array = [];
         hrange_other_array = [];
         //total_array = [];
         
         	for (qhrange in quesdata){
         		hrange_week_label = quesdata[qhrange].day;
         		hrange_total = quesdata[qhrange].matrix[0].count + quesdata[qhrange].matrix[1].count;
         		for(ihrange=0; ihrange < quesdata[qhrange].matrix.length; ihrange++){
         			if (quesdata[qhrange].matrix[ihrange].anw == "numeric"){
         				hrange_numeric_array.push({"label" : hrange_week_label, "y" : Math.round((quesdata[qhrange].matrix[ihrange].count/hrange_total)*100), "cat_name" : "numeric_response"});
         			}else if (quesdata[qhrange].matrix[ihrange].anw == "Other"){
         				hrange_other_array.push({"label" : hrange_week_label, "y" : Math.round((quesdata[qhrange].matrix[ihrange].count/hrange_total)*100), "cat_name" : "other_response"});
         			}
         			//total_array.push({"label" : week_label, "y" : no_array, "cat_name" : "other_response"});
         		}
         	}
         
         }
         });
         
         setTimeout(function () {
         var chart = new CanvasJS.Chart("chartContainer3",
         {
         	title:{
         		text: "Did you harvest any of your maize fields in the last 7 days?",
         		fontSize: 30
         	},
         	toolTip: {
         		shared: true
         	},
         	axisY: {
         		title: "Percentage of farmers",
         		maximum: 100
         	},
         	axisX: {
         		title: "Time (in weeks)",
         		interval: 1,
         		labelFontSize: 12,
         		labelAngle : -20
         	},
         	exportEnabled: true,
         	data: [
         	{
         		type: "column",
         		name: "Numeric",
         		legendText: "Numeric",
         		showInLegend: true,
         		dataPoints: hrange_numeric_array
         	},
         	{
         		type: "column",
         		name: "Other Response",
         		legendText: "Other Response",
         		showInLegend: true,
         		dataPoints: hrange_other_array
         	}
         
         	],
                 legend:{
                   cursor:"pointer",
                   itemclick: function(e){
                     if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                     	e.dataSeries.visible = false;
                     }
                     else {
                       e.dataSeries.visible = true;
                     }
                   	chart.render();
                   }
                 },
               });
         
         chart.render();
         
         }, 2000);
         
         });
         
         /* ############### */
         
         
         /* 5th graph */
         $( "#from2, #to2" ).datepicker({
                   defaultDate: "+1w",
                   changeMonth: true,
         	beforeShowDay: noSunday,
         	minDate: "09/28/2015",
         	maxDate: new Date(),
                   numberOfMonths: 2,
                   onSelect: function( selectedDate ) {
                       if(this.id == 'from2'){
                         var dateMin = $('#from2').datepicker("getDate");
                         var rMin = new Date(dateMin.getFullYear(), dateMin.getMonth(),dateMin.getDate() + 1);
                         $('#to2').datepicker("option","minDate",rMin);
                       }if(this.id == 'to2'){
                         var dateMax = $('#to2').datepicker("getDate");
                         var toMax = new Date(dateMax.getFullYear(), dateMax.getMonth(),dateMax.getDate()-1);
                         $('#from2').datepicker("option","maxDate",toMax);
                       }
         
                   }
               });
         
         function noSunday(date) {
         var day = date.getDay();
         return [(day == 1), ''];
         };
         
           //Set the initial state of the picker label
         $('#from2').val(moment(beforeMonday).format('D MMMM YYYY'));
         $('#to2').val(moment(lastMonday).format('D MMMM YYYY'));
         var storage_ques_type = "storage";
         $('#saveBtn4').click(function(){
         
         from_date = $('#from2').val();
         to_date = $('#to2').val();
         
         new_end_date = new Date(to_date);
         new_end_date_sr = new Date(new_end_date.setHours(new_end_date.getHours()+12))
         new_end_date_sr_lk = moment(new_end_date_sr).format("YYYY-MM-DDTHH:mm:ss.SSS");
         
         new_start_date = new Date(from_date);
         new_start_date_sr = new Date(new_start_date.setHours(new_start_date.getHours()+12))
         new_start_date_sr_lk = moment(new_start_date_sr).format("YYYY-MM-DDTHH:mm:ss.SSS");
         
         var new_from_date = new_start_date_sr_lk + "Z";
         var new_to_date = new_end_date_sr_lk + "Z";
         
         $.ajax({
         url: textit_prefix + "/questionanalysis?type=" + storage_ques_type + "&from=" + new_from_date + "&to=" + new_to_date,
         success: function (quesdata) {
         
         st_range_numeric_array = [];
         st_range_other_array = [];
         //total_array = [];
         
         	for (qstrange in quesdata){
         		st_range_week_label = quesdata[qstrange].day;
         		st_range_total = quesdata[qstrange].matrix[0].count + quesdata[qstrange].matrix[1].count;
         		for(istrange=0; istrange < quesdata[qstrange].matrix.length; istrange++){
         			if (quesdata[qstrange].matrix[istrange].anw == "numeric"){
         				st_range_numeric_array.push({"label" : st_range_week_label, "y" : Math.round((quesdata[qstrange].matrix[istrange].count/st_range_total)*100), "cat_name" : "numeric_response"});
         			}else if (quesdata[qstrange].matrix[istrange].anw == "Other"){
         				st_range_other_array.push({"label" : st_range_week_label, "y" : Math.round((quesdata[qstrange].matrix[istrange].count/st_range_total)*100), "cat_name" : "other_response"});
         			}
         			//total_array.push({"label" : week_label, "y" : no_array, "cat_name" : "other_response"});
         		}
         	}
         
         }
         });
         
         setTimeout(function () {
         var chart = new CanvasJS.Chart("chartContainer4",
         {
         	title:{
         		text: "How many 50kg bags of maize do you have in storage now?",
         		fontSize: 30
         	},
         	toolTip: {
         		shared: true
         	},
         	axisY: {
         		title: "Percentage of farmers",
         		maximum: 100
         	},
         	axisX: {
         		title: "Time (in weeks)",
         		interval: 1,
         		labelFontSize: 12,
         		labelAngle : -20
         	},
         	exportEnabled: true,
         	data: [
         	{
         		type: "column",
         		name: "Numeric",
         		legendText: "Numeric",
         		showInLegend: true,
         		dataPoints: st_range_numeric_array
         	},
         	{
         		type: "column",
         		name: "Other Response",
         		legendText: "Other Response",
         		showInLegend: true,
         		dataPoints: st_range_other_array
         	}
         	
         	],
                 legend:{
                   cursor:"pointer",
                   itemclick: function(e){
                     if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                     	e.dataSeries.visible = false;
                     }
                     else {
                       e.dataSeries.visible = true;
                     }
                   	chart.render();
                   }
                 },
               });
         
         chart.render();
         
         }, 2000);
         
         });
         
         /* ############### */
         
         });
      </script>
   </body>
</html>